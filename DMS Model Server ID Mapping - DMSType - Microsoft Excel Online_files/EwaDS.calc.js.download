(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[15],{1057:function(C,F,b){function a(y){var J=this;this.$=y;(this.Sl=this.$.ea.Ba(268))||d.ULS.shipAssertTag(537170070,0,!1,"CalcHelper constructor - IInstantaneousSupportInformationManager is not available");var E=t.EwaSettings.isChangeGateEnabled("OfficeVSO:5543503_loadCalcCurrentVersion")?w.a.current.mn(54):w.a.current.mn(57);this.logger=new v.a;this.documentLoc=excelOnlineCalc.location.documentLoc("",this.$.workbookContext.FullDocumentInfo.BreadcrumbDocName);
this.waa=new e(y,this.Sl);excelOnlineCalc.config.initCalc(this.logger,this.Sl?function(A){return J.Sl.isFeatureEnabled(A)}:function(){return!1},E);this.zag=excelOnlineCalc.config.calcConfig(this.waa.localeInfo)}function e(y,J){y=b(1057).CalcHelper;J&&(J.Fe||d.ULS.shipAssertTag(537169942,0,!1,"LocaleHolder constructor - locale information is not available"));this.Hfg=y.Mve(J,y.Bve(J.Gha));this.Ifg=excelOnlineCalc.calc.localeInfoFromData(this.localeData)}b.r(F);C=b(0);var d=b(15),l=b(371),n;(function(y){y[y.paren=
0]="paren";y[y.lead=1]="lead";y[y.intern=2]="intern";y[y.trail=3]="trail";y[y.undefined=4]="undefined"})(n||(n={}));Object(C.b)("CurrencyFormatOption",n);var r;(function(y){y[y.none=-1]="none";y[y.mdy=0]="mdy";y[y.dmy=1]="dmy";y[y.ymd=2]="ymd";y[y.myd=3]="myd";y[y.dym=4]="dym";y[y.ydm=5]="ydm"})(r||(r={}));Object(C.b)("DateOrderOption",r);var h=b(10);e.prototype.formatNumber=function(y){return this.localeInfo.formatNumber(y)};Ll.Object.defineProperties(e.prototype,{localeInfo:{configurable:!0,enumerable:!0,
get:function(){return this.Ifg}},localeData:{configurable:!0,enumerable:!0,get:function(){return this.Hfg}}});Object(C.a)(e,"LocaleHolder",null,[]);var v=b(1006),w=b(52),t=b(1),B=b(7),z=b(16),x=b(186);b.d(F,"CalcHelper",function(){return a});a.prototype.wZg=function(){if(t.EwaSettings.isChangeGateEnabled("OfficeVSO:4986015_LetAutocompleteTelemetry")){if(!this.$.va)return d.ULS.shipAssertTag(537170069,0,!1,"CalcHelper.CurrentSheetIndex() - this.ewaControl.Sheets is null"),0;var y=this.$.va.qa;return y?
y.index:(d.ULS.shipAssertTag(537170068,0,!1,"CalcHelper.CurrentSheetIndex() - sheet is null"),0)}return this.$.va.qa.index};a.prototype.createParser=function(){var y={};y.config=this.config;return excelOnlineCalc.parse.createParser(y)};a.prototype.createNumberFormatter=function(){var y=excelOnlineCalc.numfmt.createFormatGlobals(this.config,function(){return excelOnlineCalc.util.failure(excelOnlineCalc.util.notImplemented(["getTime"]))});return excelOnlineCalc.numfmt.createNumberFormatter(y)};a.prototype.IXg=
function(y,J,E){J=excelOnlineCalc.location.gridCell(J,E);y=excelOnlineCalc.location.sheetIndex(this.documentLoc,y);return excelOnlineCalc.location.sheetGridCell(y,J)};a.prototype.$9g=function(y,J){var E=excelOnlineCalc.calc.getEvalResultKind(y);switch(E){case 4:return{returnValue:y?this.waa.localeInfo.trueName:this.waa.localeInfo.falseName,kind:E};case 1:return{returnValue:t.EwaSettings.isChangeGateEnabled("OfficeVSO:3594728_SupportEvaluatingArrayOpersToString")?this.Uuc(this.waa.formatNumber(y),
J):this.waa.formatNumber(y),kind:E};case 2:return{returnValue:t.EwaSettings.isChangeGateEnabled("OfficeVSO:3594728_SupportEvaluatingArrayOpersToString")?this.Uuc(y.toString(),J):y.toString(),kind:E};case 128:return{returnValue:"",kind:E};case 8:switch(y.type){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:return{returnValue:this.waa.localeInfo.errorNames[y.type],kind:E};default:return{returnValue:a.unknownError,kind:E}}case 32:return{returnValue:t.EwaSettings.isChangeGateEnabled("OfficeVSO:3594728_SupportEvaluatingArrayOpersToString")?
this.Uuc(this.$Xg(y,J),J):"##UNSUPPORTED: ARRAY",kind:E};default:return{returnValue:z.a.instance.da(2115),kind:E}}};a.prototype.Uuc=function(y,J){return y.length<=J?y:y.substring(0,J-3)+"..."};a.prototype.$Xg=function(y,J){for(var E=this.waa.localeInfo.leftBrace,A=0;A<y.rows;++A){for(var H=0;H<y.cols;++H)E+=y.opers[A][H],H<y.cols-1&&(E+=this.waa.localeInfo.columnSeparator);A<y.rows-1&&(E+=this.waa.localeInfo.rowSeparator)}return this.Uuc(E,J-1)+this.waa.localeInfo.rightBrace};a.Mve=function(y,J){J=
void 0===J?null:J;var E=a.i0b(),A=y.Fe.TrueValueString,H=y.Fe.FalseValueString,S=y.Fe.DecimalSeparator.toString(),Q=y.Fe.ListSeparator.toString(),L=y.Fe.ColumnSeparator.toString(),aa=y.Fe.RowSeparator.toString(),fa=y.Fe.ThousandsDataArray,W=y.Fe.ThousandSeparator.toString(),G=y.Fe.Lcid,N=y.Fe.Country,Y=y.Fe.DigitsNumber,V=y.Fe.ExpSeparatedBySpace,da=y.Fe.FractionSeparator.toString(),U=y.Fe.PercentSeparatedBySpace,Z=B.a.pIg(Enum.toString(n,y.Fe.CurrencyFormat)),ca=y.Fe.CurrencySymbolLead,ra=y.Fe.CurrencySeparatedBySpace,
La=y.Fe.CurrencySymbolString,na=y.Fe.DigitsCurrency,ma=-1===y.Fe.DateOrder?"MDY":x.c(Enum.toString(r,y.Fe.DateOrder)),xa=y.Fe.DateSeparator.toString(),Pa=y.Fe.DateAlternativeSeparator.toString(),ib=y.Fe.Year4Digits,pb=y.Fe.Month2Digits,xb=y.Fe.Day2Digits,Ya=y.Fe.LongDateFormat,ab=y.Fe.TimeSeparator.toString(),ea=null==y.Fe.TimeAltSeparator?null:y.Fe.TimeAltSeparator.toString(),ta=y.Fe.Hour2Digits,Ka=y.Fe.Use24HourClock,mb=y.Fe.AmPmSeparatedBySpace,Ha=[y.Fe.AmString,y.Fe.PmString],Ga=y.Fe.DayNameShortArray,
Fa=y.Fe.DayNameLongArray,eb=y.Fe.MonthNameShortArray,db=y.Fe.MonthNameLongArray,Na=y.Fe.PictureSpecialArray,kb=l.a.map(("\x00"+y.Fe.PictureSingleString).split(""),function(P){return"\x00"===P?null:P}),Tb=y.Fe.PictureColorArray,ha=y.Fe.PictureDbnumArray,lb=y.Fe.RowLetter.toString(),Wa=y.Fe.ColumnLetter.toString(),Ra=y.Fe.LeftBrace.toString(),Yb=y.Fe.RightBrace.toString(),oc=y.Fe.LeftBracket.toString(),zb=y.Fe.RightBracket.toString(),uc=a.yIh(y.Fe);return excelOnlineCalc.calc.localeData(J,E,A,H,lb,
Wa,Ra,Yb,oc,zb,S,Q,L,aa,fa,W,G,N,Y,V,da,U,Z,ca,ra,La,na,ma,xa,Pa,ib,pb,xb,Ya,ab,ea,ta,Ka,mb,Ha,Ga,Fa,eb,db,Na,kb,Tb,ha,uc,y.Fe.SysDateFormatString,y.Fe.SysTimeFormatString)};a.Bve=function(y){var J=[];if(!y)return J;y=Ol(y);for(var E=y.next();!E.done;E=y.next()){E=E.value;var A=null;E.IsDynamicUdf||(A=excelOnlineCalc.calc.worksheetFunctionName(E.FunctionIndexInServer,E.NameUI));A&&Array.add(J,A)}return J};a.i0b=function(){for(var y=[],J=Object.keys(h.a.errorNames),E=0;E<J.length;E++){var A=excelOnlineCalc.calc.errorTypeName(E+
1,J[E]);A&&Array.add(y,A)}return y};a.yIh=function(y){var J=Array(6);J[1]="#"+y.AllStructRefString;J[3]="#"+y.HeadersStructRefString;J[2]="#"+y.DataStructRefString;J[4]="#"+y.TotalsStructRefString;J[5]="#"+y.ThisRowStructRefString;return J};Ll.Object.defineProperties(a.prototype,{config:{configurable:!0,enumerable:!0,get:function(){return this.zag}}});a.unknownError="##ERR##";Object(C.a)(a,"CalcHelper",null,[])},1117:function(C,F,b){function a(){}b.d(F,"a",function(){return a});C=b(0);a.Iai="literal";
a.operator="operator";a.func="function";a.namedRange="namedRange";a.range="range";a.Maf="letName";a.all="*";a.IMd="structRefRange";Object(C.a)(a,"TraverseFormulaInterestTypes",null,[])},1118:function(C,F,b){function a(){}b.d(F,"a",function(){return a});C=b(0);a.cell="cell";a.range="range";a.row="row";a.column="col";Object(C.a)(a,"TraverseFormulaRefTypes",null,[])},1377:function(C,F,b){function a(ua){var Ca=$a.call(this)||this;Ca.$=ua;Ca.Yb();return Ca}function e(ua){var Ca=Jb.call(this)||this;Ca.$=
ua;Ca.Yb();return Ca}function d(ua,Ca){this.colors="rgba(95, 140, 237, {0});rgba(235, 94, 96, {0});rgba(141, 97, 194, {0});rgba(45, 150, 57, {0});rgba(191, 76, 145, {0});rgba(227, 130, 34, {0});rgba(55, 127, 158, {0})".split(";");this.z2a=this.qXf=!1;this.Kc=ua;this.gridView=ta.g(ua);this.calcManager=Ca;this.t3h=xb.EwaSettings.isChangeGateEnabled("OfficeVSO:5041666_ImplementLogRecorderOnEwaJS");this.N8e=xb.EwaSettings.isChangeGateEnabled("OfficeVSO:5899330_SuspendResumeRichText");this.gridView.Gc.Xr(Object(V.a)(this,
this.Ozb,"onCellEditEnded"))}function l(ua,Ca,Sa,Qb){this.Zoj=ua;this.sYf=Ca;this.Pcc=void 0===Qb?!1:Qb;Sa?(this.Q3a=Sa.IsRangeRef,this.Bua=Sa.IsAbsoluteFirstRow,this.Aua=Sa.IsAbsoluteFirstColumn,this.FJa=Sa.IsAbsoluteSecondRow,this.EJa=Sa.IsAbsoluteSecondColumn):L.ULS.shipAssertTag(537169941,0,!1,"MarqueeMetadata.Ctor: parseResultItem is null")}function n(ua){var Ca=Zb.call(this)||this;Ca.$=ua;Ca.Yb();return Ca}function r(ua){var Ca=this;this.il=null;this.w5f=!1;this.lEd=this.instantaneousSupportInformationManager=
this.UBb=null;this.Iif={};this.Lif={};this.p5d=null;L.ULS.sendTraceTag(537170067,0,50,"Creating CalcManager");this.u3e=!1;this.ub=ua;this.Ix=ta.g(ua);this.fAc=null;this.gridView.uq(Object(V.a)(this,this.onContentReady,"onContentReady"));this.gridView.Ca.lPc(Object(V.a)(this,this.gkf,"onBlockPresent"));this.$.ea.$a(268,function(Sa){Sa.Fe?(L.ULS.sendTraceTag(537170066,0,50,"CalcManager.ctor: LocaleInformation already available..."),Ca.zic(Sa,Sys.EventArgs.Empty)):(L.ULS.sendTraceTag(537170065,0,50,
"CalcManager.ctor: waiting for LocaleInformation..."),Sa.Rfe(Object(V.a)(Ca,Ca.zic,"onLocaleInformationAvailable")))})}function h(){}function v(){}function w(){this.EJa=this.FJa=this.Aua=this.Bua=this.Q3a=!1}function t(ua){this.Tzd=null;this.knd=this.Szd=this.TAb=!1;this.Vxd=0;this.Nxd=this.Pxd=this.Qxd=this.Oxd=-1;this.trueName="TRUE";this.falseName="FALSE";this.instantaneousSupportInformationManager=this.Am=this.errorTypeNames=null;this.pp=this.currentStateId=-1;this.yra="";this.r9=null;this.MUf=
(this.Kc=ua)?ua.ya.CalcWebWorkerSmokeTestPingIntervalMS:this.MUf;this.Te=new mb.a;this.zob=null;this.documentLoc=excelOnlineCalc.location.documentLoc("",this.Kc.workbookContext.FullDocumentInfo.BreadcrumbDocName);this.Gma()}function B(ua){this.RWd=null;this.init(ua)}function z(){}function x(ua){this.Tla=ua;this.G4=new eb.a(db.a.rl());this.Ngc=!1}function y(){this.fj=[];this.z1f=[];this.AXa={}}function J(ua,Ca,Sa,Qb,Hb){this.type=ua;this.fullName=Ca;this.range=Sa;this.sheetId=Qb;this.attributes=Hb;
this.QF=null}function E(ua,Ca){this.tne=ua;this.sheetName=Ca;this.Mpc=!1}function A(ua){var Ca=Ga.call(this)||this;Ca.$=ua;Ca.Yb();return Ca}function H(ua,Ca){var Sa=Ha.call(this)||this;Sa.emd=U.a.Oe;Sa.JTc=null;Sa.numberFormattingCalculator=null;Sa.jec=!1;Sa.Acb=!1;Sa.Nbf=null;Sa.Obf=null;L.ULS.sendTraceTag(537155737,0,50,"InstantaneousSupportInformationManager ctor start");Sa.fa=ua;Sa.$=Ca;Sa.yDb=null;Sa.g$c=null;Sa.kIa=null;Sa.Fd=null;Sa.lhc=new mb.a;Sa.Grb=new mb.a;Sa.LW=[];Sa.tqh=new mb.a;Sa.FMe=
{};Sa.fa.Yj(Object(V.a)(Sa,Sa.Vc,"onSessionIdChanged"));Sa.$.Jk(Object(V.a)(Sa,Sa.jd,"onWorkbookOpened"));ta.g(Sa.$).ga.Tpa(Object(V.a)(Sa,Sa.sjf,"onActiveCellChange"));xb.EwaSettings.ka(308)&&Sa.fa.Vs(Object(V.a)(Sa,Sa.Gf,"onWorkbookMetadataChanged"));Sa.DOa(H.D0e);L.ULS.sendTraceTag(537155736,0,50,"InstantaneousSupportInformationManager ctor end");return Sa}function S(ua){this.data=ua}function Q(ua){var Ca=ma.call(this)||this;Ca.LFj=ua;return Ca}b.r(F);C=b(12);F=b(0);var L=b(15),aa=b(212),fa=b(35),
W=b(52),G=b(86),N=b(5),Y=b(110),V=b(37),da=b(211),U=b(10),Z=b(36),ca=b(1005),ra=b(216),La=b(1006),na=b(81),ma=Sys.EventArgs;Em(Q,ma);Object(F.a)(Q,"NumberFormatsUpdatedEventArgs",Sys.EventArgs,[]);var xa=b(43),Pa=b(42),ib=b(32),pb=b(27),xb=b(1),Ya=b(648),ab=b(7),ea=b(275),ta=b(20),Ka=b(187);Object(F.a)(S,"NumberFormatDataHolder",null,[]);var mb=b(122),Ha=Z.a;Em(H,Ha);H.prototype.Rfe=function(ua){this.addHandler(H.Yrd,ua)};H.prototype.rCd=function(ua){this.removeHandler(H.Yrd,ua)};H.prototype.xrg=
function(ua){this.addHandler(H.OUc,ua)};H.prototype.tTi=function(ua){this.removeHandler(H.OUc,ua)};H.prototype.vfe=function(ua){this.addHandler(H.q7c,ua)};H.prototype.hCd=function(ua){this.removeHandler(H.q7c,ua)};H.prototype.btg=function(ua){this.addHandler(H.Lbf,ua)};H.prototype.HJb=function(ua,Ca){var Sa=this.lhc.zc(ua,0);var Qb=Sa.value;Sa=Sa.returnValue;!Sa&&0<ua&&this.$&&(L.ULS.sendTraceTag(537155735,0,50,"InstantaneousSupportInformationManager.TryGetNumberFormatCategory: failed to get category from numberFormatIndexToCategoryCache {0}",
ua),this.yvh(ua),Ca&&(Qb=this.xvh(ua),Sa=!0),Ya.a(ua,this.$.QH)&&(Qb=6));return{returnValue:Sa,category:Qb}};H.prototype.d2h=function(ua){var Ca=this.HJb(ua,!0);var Sa=Ca.category;if(Ca.returnValue)return 6===Sa;L.ULS.sendTraceTag(537155733,0,50,"InstantaneousSupportInformationManager.IsFormatInPercentageCategory: failed to get category from format index {0}",ua);return!1};H.prototype.Soh=function(ua){L.ULS.sendTraceTag(537155730,0,50,"InstantaneousSupportInformationManager.ForceRefreshFunctionInfo: Forcing refresh of functions");
this.kIa=na.w(this.$.ra.ua,{FilterType:0},ea.b(Object(V.a)(this,this.erf,"onRefreshFunctionListSuccess"),ua),Object(V.a)(this,this.vnf,"onGetFunctionListFailed"),null,null,null)};H.prototype.dMe=function(){this.DOa(H.D0e)};H.prototype.sjf=function(){var ua=ta.g(this.$);ua&&(ua=ua.tc(null))&&this.HJb(ua.cell.numberFormatIndex,!0)};H.prototype.Drd=function(ua){this.JTc=ua};H.prototype.yvh=function(ua){if(this.Grb&&this.$){var Ca=this.Grb.zc(ua);var Sa=Ca.value;if(!Ca.returnValue||Sa.isCompleted){L.ULS.sendTraceTag(537155728,
0,50,"Getting number format category for format index: {0}",ua);Sa=this.$.ra.ua;Ca=Object(V.a)(this,this.Fsi,"onGetCategoryFromServerSuccess");var Qb=Sa.Na(1,null);Qb.ifmt=ua;(Sa=na.i(Sa,"GetNumberFormatCategory",Qb,Ca,null,null,null,4))&&this.Grb.ia(ua,Sa)}}else L.ULS.sendTraceTag(537155729,0,15,"GetCategoryFromServerAsync called on disposed InstantaneousSupportInformationManager instance, skipping")};H.prototype.xvh=function(ua){return 1<=ua&&8>=ua?1:9<=ua&&12>=ua?2:13===ua||14===ua?6:15===ua?8:
17===ua|18===ua?7:19===ua?4:16===ua||20<=ua&&29>=ua||31===ua?11:30===ua?9:32<=ua&&35>=ua?3:0};H.prototype.isActive=function(){var ua=void 0===this.fa||null===this.fa,Ca=!ua&&this.fa.lc;L.ULS.sendTraceTag(537155727,0,50,"InstantaneousSupportInformationManager.IsActive: instantaneous support information manager active:{0} - sessionStateManager IsNullOrUndefined: {1}",Ca,ua);return Ca};H.prototype.Fsi=function(ua){this.isActive()&&(pb.a.vq(ua.Errors)||!ua.Result?L.ULS.sendTraceTag(537155726,0,50,"GetCategoryFromServer failed, ignoring - server errors: {0}",
ua.Errors?ua.Errors.join(","):"None"):(ua=ua.Result,L.ULS.sendTraceTag(537155725,0,50,"Updating number format category cache, format index = {0}, category = {1}",ua.Index,ua.Category),this.c9i(ua.Index,ua.Category),this.raiseEvent(H.OUc,new ca.a(ua.Index,ua.Category),this)))};H.prototype.c9i=function(ua,Ca){this.lhc.ia(ua,Ca)};H.prototype.dispose=function(){G.a.Fa(this.yDb);this.yDb=null;this.xYb();for(var ua=Ol(this.Grb),Ca=ua.next();!Ca.done;Ca=ua.next())(Ca=Ca.value.value)&&!Ca.isCompleted&&N.AFrameworkApplication.Cd.Ku(Ca.Tt);
this.Grb=null;this.fa&&(this.fa.qk(Object(V.a)(this,this.Vc,"onSessionIdChanged")),this.Acb&&this.fa.yC(Object(V.a)(this,this.AM,"onLatestStateIdChanged")),this.Acb=!1,this.fa.Qv(Object(V.a)(this,this.Gf,"onWorkbookMetadataChanged")));this.fa=null;this.$&&ta.g(this.$)&&ta.g(this.$).ga&&(ta.g(this.$).ga.Nxa(Object(V.a)(this,this.sjf,"onActiveCellChange")),this.$.dl(Object(V.a)(this,this.jd,"onWorkbookOpened")));this.$=null;Ha.prototype.dispose.call(this)};H.prototype.isFeatureEnabled=function(ua){try{switch(ua){case "LocaleLongDateFormat":return xb.EwaSettings.ka(197);
case "GetLocaleDayNames":return xb.EwaSettings.ka(198);case "CalculateTextWidthIgnoreLetterSpacing":return xb.EwaSettings.ka(288);case "OfficeVSO:3657744_CalcFixForDateFormat":return xb.EwaSettings.isChangeGateEnabled("OfficeVSO:3657744_CalcFixForDateFormat");case "OfficeVSO:3858161_ClientSideEstimationForDateWithTheYearZero":return xb.EwaSettings.isChangeGateEnabled("OfficeVSO:3858161_ClientSideEstimationForDateWithTheYearZero");case "CalcAutocompleteExperiment":return xb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CalcTSAutocompleteExperimentIsEnabled",
!1);case "CalcNewFunctions":return xb.EwaSettings.ka(249);case "CalcContractChecks":return xb.EwaSettings.ka(250);case "CalcSupportDynamicArrays":return xb.EwaSettings.ka(251);case "CalcFormatCalculations":return xb.EwaSettings.ka(252);case "CalcFormulaCacheAPIChanges":return xb.EwaSettings.ka(253);case "CalcStrictFormulaChecking":return xb.EwaSettings.ka(254);case "CalcSupportRowReference":return xb.EwaSettings.ka(265);case "CalcParserUsesPledges":return xb.EwaSettings.ka(313);case "CalcWebWorker":return!0;
case "CalcWebWorkerTest":return xb.EwaSettings.ka(312);case "CalcLookupFunctions":return xb.EwaSettings.ka(314);case "CalcLogStopWatch":return xb.EwaSettings.ka(383);case "CalcPreventSpillingHack":return xb.EwaSettings.ka(255);case "CalcDynamicArrayOperators":return xb.EwaSettings.ka(102);case "CalcDotOperator":return xb.EwaSettings.ka(618);case "CalcLetFunction":return xb.EwaSettings.ka(745);default:return ua.startsWith("OfficeVSO:")?xb.EwaSettings.isChangeGateEnabled(ua):!1}}catch(Ca){return L.ULS.sendTraceTag(537155724,
0,15,"InstantaneousSupportInformation.IsFeatureEnabled({0}): feature parsing failed, returning false. Exception: {1}.",ua,Ca.toString()),!1}};H.prototype.DOa=function(ua){this.isActive()&&this.fa.ic.allowEdits?(G.a.Fa(this.yDb),this.yDb=null,this.yDb=xa.a.instance.create(Object(V.a)(this,this.refresh,"refresh"),ua,Pa.a.bYh)):L.ULS.sendTraceTag(537155723,0,50,"InstantaneousSupportInformationManager.ScheduleRefresh: won't schedule refresh. Edit permission: AllowEdits {0}, IsEditMode {1}",void 0!==this.fa&&
null!==this.fa&&void 0!==this.fa.ic&&null!==this.fa.ic?this.fa.ic.allowEdits:!1,void 0!==this.fa&&null!==this.fa?this.$.fa.isEditMode:!1)};H.prototype.refresh=function(){L.ULS.sendTraceTag(537155722,0,50,"InstantaneousSupportInformationManager.Refresh: start refresh");this.xYb();if(this.isActive()&&this.fa.ic.allowEdits){if(this.Acb||this.Fd&&!(this.fa.uec>this.emd))this.kxc();else{L.ULS.sendTraceTag(537155721,0,50,"InstantaneousSupportInformationManager.Refresh: getting instantaneous support information.");
var ua=this.$.ra.ua,Ca=this.Fd?this.Fd.Digest:"",Sa=Object(V.a)(this,this.iti,"onGetInstantaneousSupportInformationSuccess"),Qb=Object(V.a)(this,this.hti,"onGetInstantaneousSupportInformationFailure"),Hb=ua.Na(1,null);Hb.previousResponseDigest=Ca;this.g$c=na.i(ua,"GetInstantaneousSupportInformation",Hb,Sa,Qb,null,null,132)}L.ULS.sendTraceTag(537155720,0,50,"InstantaneousSupportInformationManager.Refresh: getting functions info.");this.RQe()}};H.prototype.RQe=function(){L.ULS.sendTraceTag(537155719,
0,50,"InstantaneousSupportInformationManager.GetFunctionsInfoAsync called.");this.kIa?L.ULS.sendTraceTag(537155718,0,50,"InstantaneousSupportInformationManager.GetFunctionsInfoAsync already running, skipping."):this.isActive()?this.LW&&this.LW.length||(this.kIa=na.w(this.$.ra.ua,{FilterType:0},Object(V.a)(this,this.cti,"onGetFunctionListSuccess"),Object(V.a)(this,this.vnf,"onGetFunctionListFailed"),null,null,null)):L.ULS.sendTraceTag(537155717,0,50,"InstantaneousSupportInformationManager.GetFunctionsInfoAsync session is not yet active, skipping.")};
H.prototype.vnf=function(ua){L.ULS.sendTraceTag(537155716,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListFailed failed, status = {0}, HTTP status = {1}.",ua.data.status,ua.data.httpStatus);this.kIa=null};H.prototype.AM=function(){this.Acb=!1;this.fa.yC(Object(V.a)(this,this.AM,"onLatestStateIdChanged"));this.DOa(this.jec?H.mJd:H.srd)};H.prototype.Vc=function(ua,Ca){L.ULS.sendTraceTag(537155715,0,50,"InstantaneousSupportInformationManager.OnSessionIdChanged called");ra.a(Ca)&&this.DOa(H.mJd)};
H.prototype.Gf=function(){L.ULS.sendTraceTag(537155714,0,50,"InstantaneousSupportInformationManager.OnWorkbookMetadataChanged called");3!==this.$.workbookContext.CalcMode&&this.Drd(!this.$.workbookContext.CalcMode)};H.prototype.jd=function(){L.ULS.sendTraceTag(537155713,0,50,"InstantaneousSupportInformationManager.OnWorkbookOpened called");this.DOa(H.mJd);xb.EwaSettings.ka(308)&&3!==this.$.workbookContext.CalcMode&&this.Drd(!this.$.workbookContext.CalcMode)};H.prototype.cti=function(ua,Ca,Sa){L.ULS.sendTraceTag(537155712,
0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess called.");this.kIa=null;this.isActive()?ua.StateId===U.a.Oe?(L.ULS.sendTraceTag(537155682,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess: no session, waiting for session."),this.kxc()):!ua.Result||this.LW&&this.LW.length?this.DOa(H.srd):this.erf(ua,Ca,Sa):L.ULS.sendTraceTag(537155683,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess: manager is inactive, skipping.")};H.prototype.erf=function(ua){this.LW=
ua.Result;L.ULS.sendTraceTag(537155681,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess refreshing functions info list, returned {0} functions.",this.LW?this.LW.length:-1);ua=!1;if(this.LW){for(var Ca=Ol(this.LW),Sa=Ca.next();!Sa.done;Sa=Ca.next())if(Sa=Sa.value)this.FMe[Sa.NameUI.toLocaleUpperCase()]=Sa.FunctionIndex.toString(),Sa.NameUI!==Sa.NameDataStrings&&(this.FMe[Sa.NameDataStrings.toLocaleUpperCase()]=Sa.FunctionIndex.toString(),ua=!0),this.tqh.ia(Sa.FunctionIndex,Sa.NameUI);
this.raiseEvent(H.q7c,Sys.EventArgs.Empty,this)}ua&&L.ULS.sendTraceTag(537155680,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess NameDataStrings functions names were used.")};H.prototype.iti=function(ua){if(this.isActive())if(L.ULS.shipAssertTag(537155679,0,!!this.$,"null ewaControl"),this.jec=!1,this.emd=ua.StateId,this.emd===U.a.Oe)this.jec=!0,this.kxc();else{if(ua.Result){var Ca=this.Fd;this.Fd=ua.Result;L.ULS.sendTraceTag(537155678,0,50,"InstantaneousSupportInformation updated, new result digest: {0}.",
this.Fd.Digest);ua=[];if(Ca)ua=H.nDh(Ca.NumberFormats,this.Fd.NumberFormats);else for(Ca=0;Ca<this.Fd.NumberFormats.length;Ca++)this.lhc.ia(Ca,this.Fd.NumberFormats[Ca].NumberFormatCategory);Ca=Ol(ua);for(var Sa=Ca.next();!Sa.done;Sa=Ca.next())Sa=Sa.value,this.lhc.ia(Sa,this.Fd.NumberFormats[Sa].NumberFormatCategory);this.iwj(ua);this.raiseEvent(H.Yrd,new Q(ua),this);xb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.StructuredReferencesInRangePicker",!1)&&this.raiseEvent(H.Lbf)}this.DOa(H.srd)}};
H.prototype.kxc=function(){this.Acb||(this.Acb=!0,this.fa.jD(Object(V.a)(this,this.AM,"onLatestStateIdChanged")))};H.prototype.hti=function(ua){this.isActive()&&(10===ua.data.status?L.ULS.sendTraceTag(537155677,0,50,"Instantaneous support information request cancelled."):(L.ULS.sendTraceTag(21311555,0,10,"Failed to update instantaneous support information, status = {0}, HTTP status = {1}.",ua.data.status,ua.data.httpStatus),this.jec=!0,this.kxc()))};H.prototype.xYb=function(){this.Ku(this.g$c);this.Ku(this.kIa);
this.kIa=this.g$c=null};H.prototype.Ku=function(ua){ua&&!ua.isCompleted&&this.$.ra.ua.Fbb(ua.Tt)};H.prototype.iwj=function(ua){var Ca=this;if(this.numberFormattingCalculator)0<ua.length&&(L.ULS.sendTraceTag(537155674,0,50,"InstantaneousSupportInformation: Updating number formatting calculator formats. IFMTs to update: {0}",ua.toString()),Qb=this.Zve(ua),this.numberFormattingCalculator.updateFormats(Qb,!0));else{L.ULS.sendTraceTag(537155676,0,50,"InstantaneousSupportInformation: Creating number formatting calculator");
ua=this.hVg();var Sa=this.Zve(null);try{var Qb=new La.a;this.numberFormattingCalculator=numFmtCalc.initializeNumberFormatingCalculator(Qb,ua,Sa,function(Hb){return Ca.isFeatureEnabled(Hb)},this.$)}catch(Hb){L.ULS.sendTraceTag(537155675,0,10,"NumberFormattingCalculator creation failed, exception = {0}. Stack error = {1}",Hb,Hb.stack)}}};H.prototype.Zve=function(ua){var Ca=this.Fd.NumberFormats.length,Sa=null;if(ua){Ca=ua.length;Sa=new mb.a;ua=Ol(ua);for(var Qb=ua.next();!Qb.done;Qb=ua.next())Qb=Qb.value,
Sa.ia(Qb,Qb)}Ca=Array(Ca);this.Nbf=this.iVg();this.Obf=this.jVg();ua=0;Qb=Ol(this.Fd.NumberFormats);for(var Hb=Qb.next();!Hb.done;Hb=Qb.next())if(Hb=Hb.value,!Sa||Sa.qb(Hb.IfmtIndex)){var Db={};Db.index=Hb.IfmtIndex;Db.formatString=" "+this.lIg(Hb.FormatString);Db.isPredefined=Hb.Builtin;Ca[ua]=Db;++ua}return Ca};H.prototype.lIg=function(ua){var Ca=this.N0h(ua),Sa=Ca?this.Nbf:this.Obf;if(Y.a.isEmpty(Sa))return ua;for(var Qb="",Hb=!1,Db=0;Db<ua.length;Db++){var jc=!1,sb=ua.charAt(Db).toString();ab.a.equals(sb,
'"',!1)?Hb=!Hb:jc=sb in Sa;var fb=Ca||H.Zej(ua,Db);Qb+=jc&&!Hb&&fb?Sa[sb]:sb}return Qb};H.prototype.jVg=function(){var ua={};H.GDa(ua,this.Fd.LocaleInformation.ThousandSeparator.toString(),",");H.GDa(ua,this.Fd.LocaleInformation.DecimalSeparator.toString(),".");return ua};H.prototype.iVg=function(){var ua={};void 0!==this.Fd.LocaleInformation.DayIndicator&&null!==this.Fd.LocaleInformation.DayIndicator&&void 0!==this.Fd.LocaleInformation.MonthIndicator&&null!==this.Fd.LocaleInformation.MonthIndicator&&
void 0!==this.Fd.LocaleInformation.YearIndicator&&null!==this.Fd.LocaleInformation.YearIndicator&&(H.GDa(ua,this.Fd.LocaleInformation.DayIndicator.toString(),"d"),H.GDa(ua,this.Fd.LocaleInformation.MonthIndicator.toString(),"m"),H.GDa(ua,this.Fd.LocaleInformation.YearIndicator.toString(),"y"));H.GDa(ua,this.Fd.LocaleInformation.DateAlternativeSeparator.toString(),"-");H.GDa(ua,this.Fd.LocaleInformation.DateSeparator.toString(),"/");return ua};H.prototype.N0h=function(ua){return-1<ua.indexOf(this.Fd.LocaleInformation.DayIndicator)||
-1<ua.indexOf(this.Fd.LocaleInformation.MonthIndicator)||-1<ua.indexOf(this.Fd.LocaleInformation.YearIndicator)};H.prototype.hVg=function(){var ua={};ua.lcid=this.Fd.LocaleInformation.Lcid;ua.amAlternativeString=this.Fd.LocaleInformation.AmAltString;ua.amPmSeparatedBySpace=this.Fd.LocaleInformation.AmPmSeparatedBySpace;ua.amString=this.Fd.LocaleInformation.AmString;ua.currencyAlternativeString="";ua.currencyFormat=this.Fd.LocaleInformation.CurrencyFormat;ua.currencySeparatedBySpace=this.Fd.LocaleInformation.CurrencySeparatedBySpace;
ua.currencyString="";ua.dateAlternativeSeparator=this.Fd.LocaleInformation.DateAlternativeSeparator.toString();ua.dateOrder=this.Fd.LocaleInformation.DateOrder;ua.dateSeparator=this.Fd.LocaleInformation.DateSeparator.toString();ua.decimalSeparator=this.Fd.LocaleInformation.DecimalSeparator.toString();ua.digitsCurrency=this.Fd.LocaleInformation.DigitsCurrency;ua.digitsNumber=this.Fd.LocaleInformation.DigitsNumber;ua.expSeparatedBySpace=this.Fd.LocaleInformation.ExpSeparatedBySpace;ua.fractionSeparator=
this.Fd.LocaleInformation.FractionSeparator.toString();ua.hour2Digits=this.Fd.LocaleInformation.Hour2Digits;ua.longDateFormat=this.Fd.LocaleInformation.LongDateFormat;ua.month2Digits=this.Fd.LocaleInformation.Month2Digits;ua.percentSeparatedBySpace=this.Fd.LocaleInformation.PercentSeparatedBySpace;ua.pmString=this.Fd.LocaleInformation.PmString;ua.pmAlternativeString=this.Fd.LocaleInformation.PmAltString;ua.thousandSeparator=this.Fd.LocaleInformation.ThousandSeparator.toString();ua.timeSeparator=this.Fd.LocaleInformation.TimeSeparator.toString();
ua.use24HourClock=this.Fd.LocaleInformation.Use24HourClock;ua.year4Digits=this.Fd.LocaleInformation.Year4Digits;ua.listSeparator=this.Fd.LocaleInformation.ListSeparator.toString();ua.columnSeparator=this.Fd.LocaleInformation.ColumnSeparator.toString();ua.rowSeparator=this.Fd.LocaleInformation.RowSeparator.toString();ua.trueValueString=this.Fd.LocaleInformation.TrueValueString;ua.falseValueString=this.Fd.LocaleInformation.FalseValueString;ua.allStructRefString=this.Fd.LocaleInformation.AllStructRefString;
ua.headersStructRefString=this.Fd.LocaleInformation.HeadersStructRefString;ua.dataStructRefString=this.Fd.LocaleInformation.DataStructRefString;ua.totalsStructRefString=this.Fd.LocaleInformation.TotalsStructRefString;ua.thisRowStructRefString=this.Fd.LocaleInformation.ThisRowStructRefString;var Ca=!(void 0===this.Fd.LocaleInformation.DayIndicator||null===this.Fd.LocaleInformation.DayIndicator),Sa=!(void 0===this.Fd.LocaleInformation.MonthIndicator||null===this.Fd.LocaleInformation.MonthIndicator),
Qb=!(void 0===this.Fd.LocaleInformation.YearIndicator||null===this.Fd.LocaleInformation.YearIndicator);Ca&&Sa&&Qb?(ua.dayIndicator=this.Fd.LocaleInformation.DayIndicator.toString(),ua.monthIndicator=this.Fd.LocaleInformation.MonthIndicator.toString(),ua.yearIndicator=this.Fd.LocaleInformation.YearIndicator.toString()):L.ULS.sendTraceTag(537155673,0,15,"Date indicators not initialized: DayIndicator is {0}, MonthIndicator is {1}, YearIndicator is {2}",Ca?"not null":"null",Sa?"not null":"null",Qb?"not null":
"null");return ua};H.nDh=function(ua,Ca){if(!ua||!ua.length)return[];if(!Ca||!Ca.length){Ca=Array(ua.length);for(var Sa=0;Sa<ua.length;++Sa)Ca[Sa]=ua[Sa].IfmtIndex;return Ca}var Qb=new mb.a;ua=Ol(ua);for(Sa=ua.next();!Sa.done;Sa=ua.next())Sa=Sa.value,Qb.ia(Sa.IfmtIndex,new S(Sa));ua=new da.a;Sa={};Ca=Ol(Ca);for(var Hb=Ca.next();!Hb.done;Sa={Ycb:Sa.Ycb,CLb:Sa.CLb},Hb=Ca.next())Sa.Ycb=Hb.value,Sa.CLb=void 0,function(Db){return function(){var jc=Qb.zc(Db.Ycb.IfmtIndex);Db.CLb=jc.value;return jc}}(Sa)().returnValue&&
Sa.CLb.data.FormatString===Sa.Ycb.FormatString||ua.add(Sa.Ycb.IfmtIndex);return ua.toArray()};H.Zej=function(ua,Ca){if(!Ca||Ca===ua.length-1)return!1;var Sa=ua.charAt(Ca-1);ua=ua.charAt(Ca+1);return"#"!==Sa&&"0"!==Sa&&"?"!==Sa||"#"!==ua&&"0"!==ua&&"?"!==ua?!1:!0};H.GDa=function(ua,Ca,Sa){ab.a.equals(Ca,Sa,!1)||(ua[Ca]=Sa)};Ll.Object.defineProperties(H.prototype,{Fe:{configurable:!0,enumerable:!0,get:function(){return this.Fd?this.Fd.LocaleInformation:null}},Maa:{configurable:!0,enumerable:!0,get:function(){return this.Fd?
this.Fd.NumberFormats:[]}},Gha:{configurable:!0,enumerable:!0,get:function(){this.LW&&this.LW.length||this.RQe();return this.LW}},calculator:{configurable:!0,enumerable:!0,get:function(){return this.numberFormattingCalculator}},YXh:{configurable:!0,enumerable:!0,get:function(){return this.Fd&&void 0!==this.Fd.InstantaneousCalcWebWorkerPrecisionSamplingRate&&null!==this.Fd.InstantaneousCalcWebWorkerPrecisionSamplingRate?this.Fd.InstantaneousCalcWebWorkerPrecisionSamplingRate:H.d0g}},aYh:{configurable:!0,
enumerable:!0,get:function(){return this.Fd&&void 0!==this.Fd.InstantaneousCalcWebWorkerSampleWorkbookStatisticsRate&&null!==this.Fd.InstantaneousCalcWebWorkerSampleWorkbookStatisticsRate?this.Fd.InstantaneousCalcWebWorkerSampleWorkbookStatisticsRate:H.h0g}},$Xh:{configurable:!0,enumerable:!0,get:function(){return this.Fd&&void 0!==this.Fd.InstantaneousCalcWebWorkerSampleRecalcStatisticsRate&&null!==this.Fd.InstantaneousCalcWebWorkerSampleRecalcStatisticsRate?this.Fd.InstantaneousCalcWebWorkerSampleRecalcStatisticsRate:
H.g0g}},ZXh:{configurable:!0,enumerable:!0,get:function(){return this.Fd&&void 0!==this.Fd.InstantaneousCalcWebWorkerSamplePrecisionPrintFormulaRate&&null!==this.Fd.InstantaneousCalcWebWorkerSamplePrecisionPrintFormulaRate?this.Fd.InstantaneousCalcWebWorkerSamplePrecisionPrintFormulaRate:H.f0g}},i2e:{configurable:!0,enumerable:!0,get:function(){return this.Fd?this.Fd.InstantaneousCalcWebWorkerRenderingTimeLimitInMs:H.e0g}},Mfd:{configurable:!0,enumerable:!0,get:function(){return null!==this.JTc?this.JTc:
this.Fd?this.Fd.InstantaneousCalcManualMode:!1}}});H.Yrd="isim0";H.OUc="isim1";H.q7c="isim2";H.Lbf="isim3";H.D0e=100;H.mJd=1E3;H.srd=3E5;H.d0g=.001;H.h0g=.1;H.g0g=.2;H.f0g=.001;H.e0g=50;Object(F.a)(H,"InstantaneousSupportInformationManager",Z.a,[419,6]);var Ga=aa.a;Em(A,Ga);A.prototype.create=function(){var ua=this;this.$&&(L.ULS.sendTraceTag(537155672,0,50,"InstantaneousSupportInformationManagerFactory.Create: Start loading script"),fa.TaskExtensions.Aa(W.a.loadScript(46,4,this.rb,void 0,void 0,
246),function(){ua.Eb(ua.$.ea.Ba(268)||new H(ua.$.fa,ua.$))},this.la,3))};A.ja=function(ua){if(!ua)throw Error.argumentNull("ewaControl");ua.ea.Ia(246,new A(ua))};Object(F.a)(A,"InstantaneousSupportInformationManagerFactory",aa.a,[]);var Fa=b(83);Object(F.a)(E,"CalcBlockInformation",null,[]);Object(F.a)(J,"CalcNamedObject",null,[]);Object(F.a)(y,"GridCache",null,[]);var eb=b(797),db=b(786);Object(F.a)(x,"SheetInformation",null,[]);var Na=b(1057),kb;(function(ua){ua[ua.initialization=0]="initialization";
ua[ua.contentReady=1]="contentReady";ua[ua.cellEdit=2]="cellEdit"})(kb||(kb={}));Object(F.b)("UpdateDataTrigger",kb);var Tb=b(60);z.local="Local";z.mpj="Thread";Object(F.a)(z,"RecalcServiceCreateMode",null,[]);var ha=b(46),lb=b(44),Wa=b(153);B.prototype.init=function(ua){this.RWd=new mb.a;if(void 0!==ua&&null!==ua&&void 0!==ua.HeadersList&&null!==ua.HeadersList&&0<ua.HeadersList.length){ua=Ol(ua.HeadersList);for(var Ca=ua.next();!Ca.done;Ca=ua.next())Ca=Ca.value,this.Y8.ia(Ca.Index,Ca.Name)}};Ll.Object.defineProperties(B.prototype,
{Y8:{configurable:!0,enumerable:!0,get:function(){return this.RWd}}});Object(F.a)(B,"ColHeadersListData",null,[]);var Ra=b(95);b(186);var Yb=b(332);t.prototype.dispose=function(){this.instantaneousSupportInformationManager&&this.instantaneousSupportInformationManager.rCd(Object(V.a)(this,this.Rpf,"onNumberFormatsUpdated"));this.Kc&&this.Kc.dl(Object(V.a)(this,this.jd,"onWorkbookOpened"));this.close()};t.prototype.Sbb=function(ua){if(!this.Am)return!1;if(!this.instantaneousSupportInformationManager&&
(this.instantaneousSupportInformationManager=this.Kc.ea.Ba(268),!this.instantaneousSupportInformationManager))return L.ULS.sendTraceTag(537170198,0,50,"CalcAsyncEngine.UpdateData Failed to get instantaneousSupportInformationManager"),!1;2!==ua&&(this.currentStateId=this.Kc.fa.uec,this.currentStateId===U.a.Oe&&(this.currentStateId=this.Kc.fa.vf));if(1===ua&&this.currentStateId<this.pp)return L.ULS.sendTraceTag(537170197,0,50,"CalcAsyncEngine::UpdateData() currentStateId:{0} < lastUpdatedStateId:{1} - ignoring update",
this.currentStateId,this.pp),!1;this.c7i();ua&&this.Szd||(this.raj(),this.y8i(),this.h9i(),this.setNumberFormats(),this.instantaneousSupportInformationManager.Rfe(Object(V.a)(this,this.Rpf,"onNumberFormatsUpdated")),this.Kc.Jk(Object(V.a)(this,this.jd,"onWorkbookOpened")),this.Szd=!0);this.COi();var Ca=!1;ua||(Ca=this.VVh());if(ua||Ca)this.C$i()?(this.gaj(ua),this.faj(),this.pp=this.currentStateId,this.OKg()):L.ULS.sendTraceTag(537170196,0,15,"CalcAsyncEngine::UpdateData() for StateId:{0} failed - no Sheets information",
this.currentStateId);2!==ua&&this.resumeRecalc();return!0};t.prototype.evalFormula=function(ua){if(!this.Am)return L.ULS.sendTraceTag(537170195,0,15,"CalcAsyncEngine.EvalFormula: recalc engine is null"),Promise.resolve({});ua=this.Am.evalFormula(this.Kc.fa.vf,ua,Tb.d(this.Kc.va.qa));this.resumeRecalc();return ua};t.prototype.evalFormulaRange=function(ua,Ca,Sa){if(!this.Am)return L.ULS.sendTraceTag(537170194,0,15,"CalcAsyncEngine.EvalFormulaRange: recalc engine is null"),Promise.reject(null);L.ULS.shipAssertTag(537170193,
0,Ca.isSingle,"CalcAsyncEngine.EvalFormulaRange: originCell Range must be a single cell.");Sa=ha.j(Sa);Ca=ha.o(Ca,this.Kc);Ca=excelOnlineCalc.calc.cellLocation(Ca.FirstRow,Ca.FirstColumn);Sa=t.cT("EvalFormulaRange",Tb.d(this.Kc.va.qa),Sa.FirstRow,Sa.FirstColumn,Sa.LastRow,Sa.LastColumn);L.ULS.sendTraceTag(537170190,0,50,"CalcAsyncEngine.EvalFormulaRange: calling calc.ts's EvalFormulaRange API for state ID {0}",this.pp);ua=this.Am.evalFormulaRange(this.pp,ua,Ca,Sa,null);ua.then(function(Qb){if(excelOnlineCalc.util.isSuccess(Qb)){var Hb=
[];Qb=Ol(Qb.value);for(var Db=Qb.next();!Db.done;Db=Qb.next())Db=Db.value,excelOnlineCalc.util.isSuccess(Db.value)||(Db=Db.value.reason.kind.toString(),Array.contains(Hb,Db)||Hb.push(Db));L.ULS.sendTraceTag(537170191,0,50,"CalcAsyncEngine.EvalFormulaRange - Evaluation of range complete. FailureReasons: {0}",Hb.length?Sys.Serialization.JavaScriptSerializer.serialize(Hb):"None")}else L.ULS.sendTraceTag(537170192,0,15,"CalcAsyncEngine.EvalFormulaRange: Calc.EvalFormulaRange returned a failed object. failure reason: {0}",
Qb.reason.kind)}).catch(function(Qb){L.ULS.sendTraceTag(537170189,0,10,"CalcAsyncEngine.EvalFormulaRange - promise rejected: {0}",Sys.Serialization.JavaScriptSerializer.serialize(Qb));return Promise.reject(Qb)});this.resumeRecalc();return ua};t.prototype.JGg=function(ua,Ca,Sa,Qb){Qb=void 0===Qb?null:Qb;if(this.Am&&ua){var Hb=Tb.d(this.Kc.va.qa),Db=ua.cell.rJ-1,jc=ua.cell.qJ-1,sb=Db,fb=jc,Qa=null;Qb&&(Qa=excelOnlineCalc.calc.cellLocation(Db,jc),Db=Qb.top-1,jc=Qb.left-1,sb=Qb.bottom-1,fb=Qb.right-1);
if(ua.cell.yv)if(Qb=ua.cell.yv.GSc,Qb===U.a.Oe)L.ULS.sendTraceTag(537170187,0,15,"CalcAsyncEngine::CalculateFormula() BlockRevision unknown for block:{0}",ua.cell.yv.Rd);else if(Qb<this.pp)L.ULS.sendTraceTag(537170185,0,50,"CalcAsyncEngine::CalculateFormula() Can't calc edit in cell:({0},{1}) - blockRevision:{2} < lastUpdatedStateId:{3}",Db,jc,Qb,this.pp);else if(Qb<this.currentStateId)L.ULS.sendTraceTag(537170184,0,50,"CalcAsyncEngine::CalculateFormula() Can't calc edit in cell:({0},{1}) - blockRevision:{2} < currentStateId:{3}",
Db,jc,Qb,this.currentStateId);else if(this.TAb||(this.Am.setOnRecalcResults(Sa),this.TAb=!0),this.l1f()&&!this.Sbb(2))L.ULS.sendTraceTag(537170183,0,15,"CalcAsyncEngine.CalculateFormula: UpdateData failed");else{fb=t.cT("CalculateFormula.cell",Hb,Db,jc,sb,fb);Sa=[];var cb=ta.g(this.Kc);sb=cb.Hh;ta.g(this.Kc).Wa.Mi&&(sb=cb.Mf(1).Hh,sb.Fla(1,1),sb.Fla(3,1));cb=null;sb?cb=t.cT("CalculateFormula.viewport",Hb,sb.top-1,sb.left-1,sb.bottom-1,sb.right-1):L.ULS.sendTraceTag(537170182,0,50,"CalcAsyncEngine::CalculateFormula() viewportRange is null, calc will use entire sheet...");
Ca=excelOnlineCalc.calc.inferredRangeFormulaEdit(fb,Ca,Qa,cb);Array.add(Sa,Ca);ua=sb?String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",Hb,Db,jc,ab.a.eWb(ua.cell.text),Qb,sb.top-1,sb.left-1,sb.bottom-1,sb.right-1):String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",Hb,Db,jc,ab.a.eWb(ua.cell.text),Qb,"","","","");L.ULS.sendTraceTag(537170181,
0,50,ua);this.Am.editRangeFormulas(Qb,Sa);this.resumeRecalc()}else L.ULS.sendTraceTag(537170186,0,15,"CalcAsyncEngine::CalculateFormula() GridBlockModelProxy is null cell:({0},{1})",ua.cell.rJ,ua.cell.qJ)}else L.ULS.sendTraceTag(537170188,0,15,"CalcAsyncEngine::CalculateFormula() recalc engine is null:{0}, modifiedCell is null:{1}",!this.Am,!ua)};t.prototype.HGg=function(ua,Ca,Sa,Qb){Qb=void 0===Qb?null:Qb;var Hb=Tb.d(this.Kc.va.qa),Db=ua.cell.rJ-1,jc=ua.cell.qJ-1,sb=Db,fb=jc,Qa=null;Qb&&(Qa=excelOnlineCalc.calc.cellLocation(Db,
jc),Db=Qb.top-1,jc=Qb.left-1,sb=Qb.bottom-1,fb=Qb.right-1);Sa=this.YRd(ua,Sa,"SetCell");0>Sa||(fb=t.cT("CalculateFormula.cell",Hb,Db,jc,sb,fb),sb=[],Qb=this.vbd(Hb),Ca=excelOnlineCalc.calc.inferredRangeFormulaEdit(fb,Ca,Qa,Qb),Array.add(sb,Ca),ua=(Ca=this.WVe())?String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",Hb,Db,jc,ab.a.eWb(ua.cell.text),Sa,Ca.top-1,Ca.left-1,Ca.bottom-1,Ca.right-1):String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",
Hb,Db,jc,ab.a.eWb(ua.cell.text),Sa,"","","",""),L.ULS.sendTraceTag(537170180,0,50,ua),this.Am.editRangeFormulas(Sa,sb),this.resumeRecalc())};t.prototype.dqb=function(ua,Ca,Sa,Qb){if(!this.Am)return L.ULS.sendTraceTag(537170179,0,15,"CalcAsyncEngine::EvalFormulaRangeOnClone recalc engine is null"),Promise.reject("RecalcService is null");L.ULS.shipAssertTag(537170178,0,Sa.isSingle,"CalcAsyncEngine::EvalFormulaRangeOnClone originCell must be a single cell.");var Hb=Tb.d(this.Kc.va.qa),Db=this.vbd(Hb),
jc=null;if(ua){jc=[];ua=Ol(ua);for(var sb=ua.next();!sb.done;sb=ua.next())if(sb=sb.value,sb.column!==Sa.left){var fb=sb.row-1;var Qa=sb.column-1;fb=t.cT("EvalFormulaRangeOnClone.cell",Hb,fb,Qa,fb,Qa);Qa=sb.text;Array.add(jc,excelOnlineCalc.calc.rangeWrite(fb,excelOnlineCalc.calc.valueCellData(Qa,Qa,sb.numberFormatIndex,null)))}}Sa=excelOnlineCalc.calc.cellLocation(Sa.top-1,Sa.left-1);Ca=t.cT("EvalFormulaRangeOnClone.outputColumnRange",Hb,Ca.top-1,Ca.left-1,Ca.bottom-1,Ca.right-1);Qb=[excelOnlineCalc.calc.cellFormulaRangeFormulaEdit(Ca,
Qb,Sa,Db)];jc=this.Am.evalOnClonedModel(jc,Qb);this.resumeRecalc();return jc};t.prototype.Rwe=function(ua){var Ca=null;try{if(ua)if(this.yra=ta.g(this.Kc).Ca.hta(ua),this.currentStateId=ua.pQa,this.currentStateId<this.pp||this.currentStateId===U.a.Oe)L.ULS.sendTraceTag(537170176,0,50,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel() hash:{0} blockRevision:{1} < lastUpdatedStateId:{2}",this.yra,this.currentStateId,this.pp);else{if(this.$Vh(),!this.UBg()){var Sa=String.format("CalcAsyncEngine::CreateUpdatedRangesFromBlockModel() Block Hash:{0} StateId:{1}",
this.yra,this.currentStateId);Ca=this.Kc.Vb.Dc("ModelUpdate",Sa);this.zob=this.l1a(ua.qa.sheetName);if(!this.zob){var Qb=!!(this.Kc.zd&32);L.ULS.sendTraceTag(537170147,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel SheetName not found. Number of existing sheets {0}, scratchPad:{1}, sheetNameLength:{2} Hash:{3}",this.Te.qb(this.currentStateId)&&this.Te.oa(this.currentStateId).fj?this.Te.oa(this.currentStateId).fj.length:0,Qb,ua.qa.sheetName?ua.qa.sheetName.length:-1,ua.qa.hash)}else if(ta.g(this.Kc).Ca.zl.BZa(ua.Rd)){var Hb=
ua.Wf;if(Hb){var Db=Hb.getCalcBlockModel();if(!Db)L.ULS.sendTraceTag(537170145,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel no model for block");else if(this.MBg(Db)){this.Te.oa(this.currentStateId).AXa[this.yra]=new E(Db,ua.qa.sheetName);var jc=ua.me;jc?this.npg(jc.NamedObjects):L.ULS.sendTraceTag(537170144,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel GetGridBlockContentResponse is null")}}else L.ULS.sendTraceTag(537170146,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel no model accessor for block:{0}",
this.yra)}}}else L.ULS.shipAssertTag(537170177,0,!1,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel() blockCacheItem is null")}finally{Ca&&Ca.stop()}};t.prototype.Tsb=function(ua){if(!this.Te.oa(this.currentStateId).fj||!this.Te.oa(this.currentStateId).fj[0])return null;var Ca=this.Te.oa(this.currentStateId).fj[0].G4;if(!Ca||!Ca.qb(ua.name))return null;Ca=Ca.oa(ua.name);if(!Ca||!Ca.QF)return null;ua=new da.a;Ca=Ol(Ca.QF.Y8);for(var Sa=Ca.next();!Sa.done;Sa=Ca.next())ua.add(Sa.value.value);return ua};
t.prototype.getNameLoc=function(ua,Ca){return this.tcc()?this.Te.oa(this.currentStateId).fj[0].G4.qb(Ca)?(ua=excelOnlineCalc.location.nameLoc(ua,Ca),excelOnlineCalc.util.success(ua)):excelOnlineCalc.util.success(null):(ua=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(ua))};t.prototype.getContainingTable=function(ua){if(!this.tcc())return ua=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(ua);var Ca=ua.range.col,Sa=ua.range.row,Qb=this.Te.oa(this.currentStateId).fj[0].G4,
Hb=null;Qb=Ol(Qb);for(var Db=Qb.next();!Db.done;Db=Qb.next())if(Db=Db.value.value,2===Db.type&&ab.a.equals(ua.sheet.index.toString(),Db.sheetId,!0)){var jc=Db.range;Ca>=jc.left-1&&Ca<=jc.right-1&&Sa<=jc.bottom-1&&Sa>=jc.top-1&&(Hb=excelOnlineCalc.location.nameScope(this.documentLoc,Db.sheetId),Hb=excelOnlineCalc.location.nameLoc(Hb,Db.fullName))}return Hb?excelOnlineCalc.util.success(Hb):excelOnlineCalc.util.success(null)};t.prototype.getStructRefColumn=function(ua,Ca){if(!this.tcc()){var Sa=excelOnlineCalc.util.unavailable([2]);
return excelOnlineCalc.util.failure(Sa)}Sa=ua.name;var Qb=this.Te.oa(this.currentStateId).fj[0].G4;if(Qb.qb(Sa)){Qb=Qb.oa(Sa);var Hb=Qb.range;if(2!==Qb.type)return excelOnlineCalc.util.failure(this.rZc(5));var Db=Qb.QF?Qb.QF.Y8:null;if(!Db)return excelOnlineCalc.util.success(null);for(var jc=Ol(Db),sb=jc.next();!sb.done;sb=jc.next())if(sb=sb.value,ab.a.equals(sb.value,Ca,!0))return ua=excelOnlineCalc.location.documentLoc(ua.scope.document.path,ua.scope.document.name),ua=excelOnlineCalc.location.sheetIndex(ua,
Qb.sheetId),Hb=excelOnlineCalc.location.gridRange(Hb.top-1,sb.key,Hb.bottom-Hb.top+1,1),Hb=excelOnlineCalc.location.sheetGridRange(ua,Hb),Sa=excelOnlineCalc.location.structRefColumnLoc(Sa,Hb,!!(Qb.attributes&16),!!(Qb.attributes&8)),excelOnlineCalc.util.success(Sa);return Hb.right-Hb.left+1!==Db.count?(Sa=excelOnlineCalc.util.unavailable([17,ua,Ca]),excelOnlineCalc.util.failure(Sa)):excelOnlineCalc.util.failure(this.rZc(0))}return excelOnlineCalc.util.success(null)};t.prototype.getStructRefSpecialRef=
function(ua,Ca){if(!this.tcc())return Ca=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(Ca);var Sa=this.Te.oa(this.currentStateId).fj[0].G4;if(Sa.qb(ua.name)){var Qb=Sa.oa(ua.name);if(2!==Qb.type)return excelOnlineCalc.util.failure(this.rZc(5));Sa=!!(Qb.attributes&16);var Hb=!!(Qb.attributes&8),Db=Sa?1:0,jc=Hb?1:0;ua=excelOnlineCalc.location.documentLoc(ua.scope.document.path,ua.scope.document.name);ua=excelOnlineCalc.location.sheetIndex(ua,Qb.sheetId);Qb=Qb.range;var sb={};if(1===
Ca)sb=excelOnlineCalc.location.gridRange(Qb.top-Db-1,Qb.left-1,Qb.bottom+jc-Qb.top+Db+1,Qb.right-Qb.left+1);else if(2===Ca)sb=excelOnlineCalc.location.gridRange(Qb.top-1,Qb.left-1,Qb.bottom-Qb.top+1,Qb.right-Qb.left+1);else if(3===Ca)if(Sa)sb=excelOnlineCalc.location.gridRange(Qb.top-2,Qb.left-1,1,Qb.right-Qb.left+1);else return excelOnlineCalc.util.success(null);else if(4===Ca)if(Hb)sb=excelOnlineCalc.location.gridRange(Qb.bottom,Qb.left-1,1,Qb.right-Qb.left+1);else return excelOnlineCalc.util.success(null);
Ca=excelOnlineCalc.location.sheetGridRange(ua,sb);return excelOnlineCalc.util.success(Ca)}return excelOnlineCalc.util.success(null)};t.prototype.getDocumentLoc=function(ua,Ca){if((ab.a.equals(ua,this.documentLoc.path,!0)||!ua)&&ab.a.equals(Ca,this.documentLoc.name,!0))return excelOnlineCalc.util.success(this.documentLoc);ua=excelOnlineCalc.util.unavailable([0,excelOnlineCalc.location.documentLoc(ua,Ca)]);return excelOnlineCalc.util.failure(ua)};t.prototype.getSheetIndex=function(ua,Ca){if(!this.Te.qb(this.currentStateId)||
!this.Te.oa(this.currentStateId).fj)return Ca=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(Ca);ua=this.Te.oa(this.currentStateId).fj;for(var Sa=1;Sa<ua.length;Sa++)if(ab.a.equals(ua[Sa].Tla.sheetName,Ca,!0))return excelOnlineCalc.util.success(ua[Sa].Tla.sheetId);return excelOnlineCalc.util.success(null)};t.prototype.getSheetName=function(ua,Ca){if(!this.Te.qb(this.currentStateId)||!this.Te.oa(this.currentStateId).fj)return Ca=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(Ca);
ua=this.Te.oa(this.currentStateId).fj;for(var Sa=1;Sa<ua.length;Sa++)if(ab.a.equals(ua[Sa].Tla.sheetId,Ca,!0))return excelOnlineCalc.util.success(ua[Sa].Tla.sheetName);return excelOnlineCalc.util.success(null)};t.prototype.getUserDefinedFuncLoc=function(){return excelOnlineCalc.util.notImplemented(["ParseGlobals.GetUserDefinedFuncLoc not implemented in main thread"])};t.prototype.getSheetRangeIndexes=function(){return excelOnlineCalc.util.notImplemented(["ParseGlobals.GetSheetRangeIndexes not implemented in main thread"])};
t.prototype.IGg=function(ua,Ca,Sa){var Qb=ta.g(this.Kc),Hb=Qb.tc(Ca);Hb=this.YRd(Hb,null,"CopyPaste");Sa=this.YRd(Qb.tc(ua),Sa,"CopyPaste");if(0>Hb||0>Sa||Hb!==Sa)L.ULS.sendTraceTag(537170143,0,15,"CalcAsyncEngine::CalculateFormulaForCopyPaste(). Revision not valid. sourceRevision:{0}, targetRevision:{1}.",Sa,Hb);else{Sa=[];Qb=Tb.d(this.Kc.va.qa);var Db=this.vbd(Qb);ua=t.cT("CalculateFormulaForCopyPaste.srcRange",Qb,ua.top-1,ua.left-1,ua.bottom-1,ua.right-1);Ca=t.cT("CalculateFormulaForCopyPaste.targetRange",
Qb,Ca.top-1,Ca.left-1,Ca.bottom-1,Ca.right-1);Ca=excelOnlineCalc.calc.copyPasteRangePasteEdit(Ca,ua,Db);Array.add(Sa,Ca);Ca=Db?String.format("CalcAsyncEngine::CalculateFormulaForCopyPaste() for sheet:{0}, stateId:{1} viewport:(({2},{3})-({4},{5}))",Qb,Hb,Db.row,Db.column,Db.lastRow,Db.lastColumn):String.format("CalcAsyncEngine::CalculateFormulaForCopyPaste() for sheet:{0}, stateId:{1} viewport:(({2},{3})-({4},{5}))",Qb,Hb,"","","","");L.ULS.sendTraceTag(537170142,0,50,Ca);this.Am.editRangePaste(Hb,
Sa);this.resumeRecalc()}};t.prototype.vbd=function(ua){var Ca=this.WVe(),Sa=null;Ca?Sa=t.cT("GetViewport.viewport",ua,Ca.top-1,Ca.left-1,Ca.bottom-1,Ca.right-1):L.ULS.sendTraceTag(537170141,0,50,"CalcAsyncEngine::GetViewport() viewportRange is null, calc will use entire sheet...");return Sa};t.prototype.WVe=function(){var ua=ta.g(this.Kc),Ca=ua.Hh;if(ta.g(this.Kc).Wa.Mi){Ca=ua.Mf(1).Hh;if(xb.EwaSettings.isChangeGateEnabled("OfficeVSO:5497152_JSCrash_At_CalcAsyncEngine_GetViewportRange")&&!Ca)return L.ULS.sendTraceTag(537170140,
0,15,"CalcAsyncEngine::GetViewportRange viewportRange is null."),null;Ca.Fla(1,1);Ca.Fla(3,1)}return Ca};t.prototype.YRd=function(ua,Ca,Sa){if(!this.Am||!ua)return L.ULS.sendTraceTag(537170139,0,15,"CalcAsyncEngine::ValidateCalculateFormulaInit() recalc engine is null:{0}, modifiedCell is null:{1}, operation:{2}",!this.Am,!ua,Sa),-1;var Qb=ua.cell.rJ-1,Hb=ua.cell.qJ-1;if(ua.cell.yv){var Db=ua.cell.yv.GSc;if(Db===U.a.Oe)return L.ULS.sendTraceTag(537170138,0,15,"CalcAsyncEngine::ValidateCalculateFormulaInit() BlockRevision unknown for block:{0}, operation:{1}",
ua.cell.yv.Rd,Sa),-1}else return L.ULS.sendTraceTag(537170137,0,15,"CalcAsyncEngine::ValidateCalculateFormulaInit() GridBlockModelProxy is null cell:({0},{1}), operation:{2}",ua.cell.rJ,ua.cell.qJ,Sa),-1;if(Db<this.pp)return L.ULS.sendTraceTag(537170136,0,50,"CalcAsyncEngine::ValidateCalculateFormulaInit() Can't calc edit in cell:({0},{1}) - blockRevision:{2} < lastUpdatedStateId:{3}, operation:{4}",Qb,Hb,Db,this.pp,Sa),-1;if(Db<this.currentStateId)return L.ULS.sendTraceTag(537170135,0,50,"CalcAsyncEngine::ValidateCalculateFormulaInit() Can't calc edit in cell:({0},{1}) - blockRevision:{2} < currentStateId:{3}, operation:{4}",
Qb,Hb,Db,this.currentStateId,Sa),-1;Ca&&!this.TAb&&(this.Am.setOnRecalcResults(Ca),this.TAb=!0);return this.l1f()&&!this.Sbb(2)?(L.ULS.sendTraceTag(537170134,0,15,"CalcAsyncEngine.ValidateCalculateFormulaInit: UpdateData failed. operation:{0}",Sa),-1):Db};t.prototype.getFormulaBarText=function(ua,Ca,Sa){return Ca&&Ca.startsWith("'")?Ca:ua.cell.formulaBarText||Sa.toString()};t.prototype.QWg=function(ua,Ca,Sa){var Qb=null;if(this.Zne()&&this.Te.oa(this.pp).AXa){var Hb=this.Te.oa(this.pp).AXa[ua];Hb&&
Hb.Mpc&&(Qb=Hb.tne)}Sa=this.u_h(Qb,Ca,Sa);Ca=this.jOg(Qb,Ca,Sa);L.ULS.sendTraceTag(50671754,0,50,"CalcAsyncEngine::CreateRangeUpdateCommands() completed for Block Hash:{0} StateId:{1} number of formulas {2}",ua,this.currentStateId,Ca)};t.prototype.u_h=function(ua,Ca,Sa){var Qb=!1,Hb=t.zOe(Ca);if(ua){var Db=t.zOe(ua);ab.a.equals(Db,Hb,!1)&&(Qb=!0)}Qb?this.Ppg(ua,this.pp,Sa):this.Rpg(Ca,Sa);return Qb};t.prototype.Zne=function(){var ua=!1;this.Am&&-1!==this.pp&&(ua=this.Am.stateIdAvailable(this.pp));
return ua&&this.Te.qb(this.pp)&&this.pp<this.currentStateId};t.prototype.jOg=function(ua,Ca,Sa){var Qb=0;var Hb,Db;for(Ca.reset();Hb=Ca.getNextCell();)Ka.e(Hb.formula)&&Qb++,(Db=Sa?ua.getCell(Hb.row,Hb.col):null)?this.fOg(Ca,Hb,Db):this.Qpg(Ca,Hb);if(Sa)for(ua.reset();Db=ua.getNextCell();)(Hb=Ca.getCell(Db.row,Db.col))||this.qee(ua,Db);return Qb};t.prototype.h9i=function(){this.Am.setOnUpdateRequest(function(){})};t.prototype.g9i=function(){var ua=this;this.Am.setOnUnresponsive(function(Ca,Sa,Qb,
Hb){ua.ZAi(Ca,Sa,Qb,Hb)})};t.prototype.ZAi=function(ua,Ca,Sa,Qb){L.ULS.sendTraceTag(537170126,0,15,"CalcAsyncEngine.onUnresponsive: worker thread was unresponsive. timeout:{0}, waitTime:{1}, timeoutCount:{2}, hasBeenClosed:{3}.",ua,Ca,Sa,Qb);Qb&&(this.tZi(),this.Gma())};t.prototype.tZi=function(){this.jd(null,null);this.knd=this.TAb=!1;this.Vxd=0;this.Nxd=this.Pxd=this.Qxd=this.Oxd=-1};t.prototype.close=function(){this.Am.close()};t.prototype.clearCache=function(){this.Am.clearCache()};t.prototype.resumeRecalc=
function(){this.Am.resumeRecalc()};t.prototype.y8i=function(){this.Am.setA1ReferenceStyle(!0)};t.prototype.COi=function(){if(this.instantaneousSupportInformationManager){var ua=this.instantaneousSupportInformationManager.YXh,Ca=this.instantaneousSupportInformationManager.aYh,Sa=this.instantaneousSupportInformationManager.$Xh,Qb=this.instantaneousSupportInformationManager.ZXh,Hb=!1;ua!==this.Oxd&&(Hb=!0,this.Oxd=ua);Ca!==this.Qxd&&(Hb=!0,this.Qxd=Ca);Sa!==this.Pxd&&(Hb=!0,this.Pxd=Sa);Qb!==this.Nxd&&
(Hb=!0,this.Nxd=Qb);var Db=[];xb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CalcTSExceLintExperimentIsEnabled",!1)&&(Hb=excelOnlineCalc.calc.runExperiment("ExceLintExperiment",null),Db.push(Hb),Hb=!0);xb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.UnitExperiment",!1)&&(Hb=excelOnlineCalc.calc.runExperiment("UnitExperiment",null),Db.push(Hb),Hb=!0);xb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CalcTSAutocompleteExperimentIsEnabled",!1)&&(Hb=excelOnlineCalc.calc.runExperiment("AutocompleteExperiment",
null),Db.push(Hb),Hb=!0);Hb&&(ua=excelOnlineCalc.calc.recalcServiceConfig(null,ua,null,Ca,null,null,null,Sa,Db,Qb),this.Am.reconfigure(ua))}};t.prototype.gaj=function(ua){var Ca=this,Sa=null;if(this.Te.qb(this.currentStateId))try{this.r9=[];var Qb=String.format("CalcAsyncEngine::SetUpdatedRanges() StateId:{0} UpdateTriggerData:{1}",this.currentStateId,kb[ua]);Sa=this.Kc.Vb.Dc("ModelUpdate",Qb);Y.a.forEach(this.Te.oa(this.currentStateId).AXa,function(Hb,Db){Db.Mpc||(Ca.QWg(Hb,Db.tne,Db.sheetName),
Db.Mpc=!0)},null);this.Am.updateRanges(this.currentStateId,this.r9)}finally{Sa&&Sa.stop()}else L.ULS.sendTraceTag(537170122,0,15,"CalcAsyncEngine::SetUpdatedRanges StateId:{0} does not exist in GridCache",this.currentStateId)};t.prototype.faj=function(){var ua=[],Ca=this.Zne(),Sa=Ca&&this.Te.oa(this.pp).fj&&this.Te.oa(this.pp).fj[0]&&this.Te.oa(this.pp).fj[0].Ngc?this.Te.oa(this.pp).fj[0].G4:null;this.Mse(Sa,this.Te.oa(this.currentStateId).fj[0].G4,null,this.pp,ua);this.Te.oa(this.currentStateId).fj[0].Ngc=
!0;for(var Qb=1;Qb<this.Te.oa(this.currentStateId).fj.length;Qb++)Sa=-1,Ca&&this.Te.oa(this.pp).fj&&(Sa=this.Ead(this.Te.oa(this.currentStateId).fj[Qb].Tla.sheetName,this.pp)),Sa=-1!==Sa&&this.Te.oa(this.pp).fj[Sa].Ngc?this.Te.oa(this.pp).fj[Sa].G4:null,this.Mse(Sa,this.Te.oa(this.currentStateId).fj[Qb].G4,this.Te.oa(this.currentStateId).fj[Qb].Tla.sheetId,this.pp,ua),this.Te.oa(this.currentStateId).fj[Qb].Ngc=!0;this.Am.updateNamedObjects(this.currentStateId,ua)};t.prototype.Mse=function(ua,Ca,Sa,
Qb,Hb){if(void 0!==Sa&&null!==Sa){var Db=excelOnlineCalc.calc.undefinedNamesWrite(Sa);Array.add(Hb,Db)}if(ua){var jc=!1,sb=[];Db=[];if(Ca)for(var fb=Ol(Ca),Qa=fb.next();!Qa.done;Qa=fb.next()){Qa=Qa.value;var cb=Qa.value;if(ua.qb(Qa.key)){var Ab=ua.oa(Qa.key);t.Zki(Ab,cb)?jc=!0:(Ab=excelOnlineCalc.calc.namedObject(Qa.key,null),Array.add(sb,Ab),t.LOc(Qa.key,cb,Db))}else t.LOc(Qa.key,cb,Db)}ua=Ol(ua);for(Qa=ua.next();!Qa.done;Qa=ua.next())fb=Qa.value,Ca&&Ca.qb(fb.key)||(fb=excelOnlineCalc.calc.namedObject(fb.key,
null),Array.add(sb,fb));jc&&(Ca=excelOnlineCalc.calc.namedObjectsPromote(Sa,Qb),Array.add(Hb,Ca));0<sb.length&&(Ca=excelOnlineCalc.calc.namedObjectsWrite(Sa,sb),Array.add(Hb,Ca));0<Db.length&&(Sa=excelOnlineCalc.calc.namedObjectsWrite(Sa,Db),Array.add(Hb,Sa))}else if(Ca){Db=[];Ca=Ol(Ca);for(Qb=Ca.next();!Qb.done;Qb=Ca.next())Qb=Qb.value,t.LOc(Qb.key,Qb.value,Db);0<Db.length&&(Sa=excelOnlineCalc.calc.namedObjectsWrite(Sa,Db),Array.add(Hb,Sa))}};t.prototype.UBg=function(){return this.Te.oa(this.currentStateId).AXa[this.yra]?
(L.ULS.sendTraceTag(537170121,0,50,"CalcAsyncEngine::BlockPreviouslyHandled Block Hash:{0} StateId:{1} previously handled",this.yra,this.currentStateId),!0):!1};t.prototype.MBg=function(ua){return 1===ua.getColumnNumbers().length&&ua.getColumnNumbers()[0]===t.opd+1?!1:!0};t.prototype.VVh=function(){var ua=this,Ca=!1;ta.g(this.Kc).Ca.L6c(function(Sa){Sa.state&1&&ua.Kc.fa.vf===Sa.ue.Revision&&(ua.Rwe(Sa),Ca=!0)});return Ca};t.prototype.Xue=function(ua,Ca){var Sa=ua.getRowNumbers(),Qb=ua.getColumnNumbers();
ua=Sa[0]-1;Sa=Sa[Sa.length-1]-1;var Hb=Qb[0]-1;Qb=Qb[Qb.length-1]-1;(Ca=this.l1a(Ca))||L.ULS.sendTraceTag(537170120,0,15,"CalcAsyncEngine::CreateBlockRangeLocation SheetName not found. Number of existing sheets {0}",this.Te.qb(this.currentStateId)&&this.Te.oa(this.currentStateId).fj?this.Te.oa(this.currentStateId).fj.length:0);return t.cT("CreateBlockRangeLocation",Ca,ua,Hb,Sa,Qb)};t.prototype.Ppg=function(ua,Ca,Sa){if(Sa=this.Xue(ua,Sa)){var Qb=t.j0b(ua.getRowNumbers());ua=t.j0b(ua.getColumnNumbers());
Ca=excelOnlineCalc.calc.rangePromote(Sa,Ca,Qb,ua);this.r9[this.r9.length]=Ca}};t.prototype.Rpg=function(ua,Ca){if(Ca=this.Xue(ua,Ca)){var Sa=t.j0b(ua.getRowNumbers());ua=t.j0b(ua.getColumnNumbers());ua=excelOnlineCalc.calc.rangeWrite(Ca,null,Sa,ua);this.r9[this.r9.length]=ua}};t.prototype.fOg=function(ua,Ca,Sa){var Qb=null,Hb=0,Db=0;switch(Ca.valueType){case 2:Qb=this.sbd(Ca);var jc=this.sbd(Sa);jc=ab.a.equals(jc,Qb,!1);break;case 1:null===Ca.value&&null===Sa.value?jc=!0:(Hb=parseFloat(Ca.value),
jc=parseFloat(Sa.value)===Hb);break;default:null===Ca.value&&null===Sa.value?jc=!0:(Db=parseFloat(Ca.value),jc=Db===parseFloat(Sa.value))}jc&&Ca.valueType===Sa.valueType&&Ca.ifmt===Sa.ifmt&&Ca.formulaType===Sa.formulaType&&ab.a.equals(Sa.formula,Ca.formula,!1)||(void 0!==Ca.formula&&null!==Ca.formula||void 0!==Ca.value&&null!==Ca.value||void 0!==Ca.text&&null!==Ca.text?this.QUb(ua,Ca,Qb,Hb,Db):this.qee(ua,Ca))};t.prototype.npg=function(ua){if(this.Kc.wb&&this.Kc.wb.items)for(var Ca=0;Ca<this.Kc.wb.count;Ca++){var Sa=
this.Kc.wb.items[Ca];if(2===Sa.type||3===Sa.type){var Qb=0,Hb=Sa.name,Db=Hb.lastIndexOf("!");if(0<Db){Qb=Hb.substr(0,Db);"'"===Qb.charAt(0)&&(Qb=Qb.substr(1,Qb.length-2));Qb=this.Ead(Qb,this.currentStateId);if(-1===Qb){L.ULS.sendTraceTag(595096334,0,15,"CalcAsyncEngine::AddNamedObjectsInBlock SheetName not found. Number of existing sheets {0}",this.Te.qb(this.currentStateId)&&this.Te.oa(this.currentStateId).fj?this.Te.oa(this.currentStateId).fj.length:0);continue}Hb=Hb.substr(Db+1)}Qb=this.Te.oa(this.currentStateId).fj[Qb].G4;
var jc=Sa.usedRange;2===Sa.type&&(jc=Wa.a(Sa));if(Qb.qb(Hb)){if(Db=Qb.oa(Hb),xb.EwaSettings.isChangeGateEnabled("OfficeVSO:5502630_AddNamedObjectsInBlock_updateRange")&&(Db.range=jc,Db.attributes=Sa.attributes),2===Db.type&&(Hb=t.JKe(Sa.name,ua)))if(!Db.QF)Db.QF=new B(Hb.ColHeadersList);else if(Hb.ColHeadersList)for(Hb=Ol(Hb.ColHeadersList.HeadersList),Sa=Hb.next();!Sa.done;Sa=Hb.next())Sa=Sa.value,Db.QF.Y8.ia(Sa.Index,Sa.Name)}else(Db=this.l1a(Sa.sheetName))?(Db=new J(Sa.type,Sa.name,jc,Db,Sa.attributes),
2===Db.type&&(Sa=t.JKe(Sa.name,ua))&&(Db.QF=new B(Sa.ColHeadersList)),Qb.ia(Hb,Db)):L.ULS.sendTraceTag(537170117,0,50,"CalcAsyncEngine::AddNamedObjectsInBlock SheetName not found. Number of existing sheets {0}",this.Te.qb(this.currentStateId)&&this.Te.oa(this.currentStateId).fj?this.Te.oa(this.currentStateId).fj.length:0)}}};t.prototype.QUb=function(ua,Ca,Sa,Qb,Hb){var Db=ua.getRowNumbers()[Ca.row]-1;ua=ua.getColumnNumbers()[Ca.col]-1;Db=t.cT("AddRangeUpdateCommand",this.zob,Db,ua,Db,ua);ua=null;
var jc=Ca.formula||Ca.text,sb=excelOnlineCalc.calc.blankValue,fb=null;void 0!==Ca.text&&null!==Ca.text||void 0!==Ca.value&&null!==Ca.value||(Sa="",fb="This cell contains blanks only",Ca.formulaType||(jc=""));switch(Ca.valueType){case 2:null!==Sa&&(Ca.formulaType||(ua=excelOnlineCalc.calc.valueCellData(jc,Sa,Ca.ifmt,fb)),1===Ca.formulaType&&(ua=excelOnlineCalc.calc.cellFormulaCellData(jc,Sa,Ca.ifmt,fb)),2===Ca.formulaType&&(ua=excelOnlineCalc.calc.valueCellData("",sb,0,"This cell is a part of an array")));
break;case 1:isNaN(Qb)?L.ULS.sendTraceTag(537170116,0,50,"CalcAsyncEngine::AddRangeUpdateCommand Cell({0},{1}) invalid numeric value",Ca.row,Ca.col):(Ca.formulaType||(ua=excelOnlineCalc.calc.valueCellData(jc,Qb,Ca.ifmt,null)),1===Ca.formulaType&&(ua=excelOnlineCalc.calc.cellFormulaCellData(jc,Qb,Ca.ifmt,null)),2===Ca.formulaType&&(ua=excelOnlineCalc.calc.valueCellData("",sb,0,"This cell is a part of an array")));break;case 3:isNaN(Hb)?L.ULS.sendTraceTag(537170115,0,15,"CalcAsyncEngine::AddRangeUpdateCommand Cell({0},{1}) invalid boolean value",
Ca.row,Ca.col):(Sa=1===Hb?!0:!1,Ca.formulaType||(ua=excelOnlineCalc.calc.valueCellData(jc,Sa,Ca.ifmt,null)),1===Ca.formulaType&&(ua=excelOnlineCalc.calc.cellFormulaCellData(jc,Sa,Ca.ifmt,null)),2===Ca.formulaType&&(ua=excelOnlineCalc.calc.valueCellData("",sb,0,"This cell is a part of an array")));break;case 4:isNaN(Hb)?L.ULS.sendTraceTag(537170114,0,15,"CalcAsyncEngine::AddRangeUpdateCommand Cell({0},{1}) invalid error value",Ca.row,Ca.col):(Sa=excelOnlineCalc.calc.errorValue(Hb),Ca.formulaType||
(ua=excelOnlineCalc.calc.valueCellData(jc,Sa,Ca.ifmt,null)),1===Ca.formulaType&&(ua=excelOnlineCalc.calc.cellFormulaCellData(jc,Sa,Ca.ifmt,null)),2===Ca.formulaType&&(ua=excelOnlineCalc.calc.valueCellData("",sb,0,"This cell is a part of an array")));break;default:ua=excelOnlineCalc.calc.valueCellData("",sb,Ca.ifmt,null)}ua&&(Ca=excelOnlineCalc.calc.rangeWrite(Db,ua,null,null),this.r9[this.r9.length]=Ca)};t.prototype.Qpg=function(ua,Ca){switch(Ca.valueType){case 2:this.QUb(ua,Ca,this.sbd(Ca),null,
0);break;case 1:this.QUb(ua,Ca,null,parseFloat(Ca.value),0);break;default:this.QUb(ua,Ca,null,null,parseFloat(Ca.value))}};t.prototype.qee=function(ua,Ca){var Sa=ua.getRowNumbers()[Ca.row]-1;ua=ua.getColumnNumbers()[Ca.col]-1;Sa=t.cT("AddRangeUpdateCommandEmptyCell",this.zob,Sa,ua,Sa,ua);Ca=excelOnlineCalc.calc.valueCellData("",excelOnlineCalc.calc.blankValue,Ca.ifmt,null);Ca=excelOnlineCalc.calc.rangeWrite(Sa,Ca,null,null);this.r9[this.r9.length]=Ca};t.prototype.l1a=function(ua){ua=this.Ead(ua,this.currentStateId);
return 0<ua?this.Te.oa(this.currentStateId).fj[ua].Tla.sheetId:null};t.prototype.Ead=function(ua,Ca){if(!this.Te.qb(Ca))return L.ULS.sendTraceTag(537170113,0,15,"CalcAsyncEngine.GetSheetInternalIndex StateId:{0} does not exist in GridCache",Ca),-1;if(!this.Te.oa(Ca).fj)return L.ULS.sendTraceTag(537170112,0,15,"CalcAsyncEngine.GetSheetInternalIndex sheetsInformation == null for StateId:{0}",Ca),-1;Ca=this.Te.oa(Ca).fj;for(var Sa=1;Sa<Ca.length;Sa++)if(ab.a.equals(Ca[Sa].Tla.sheetName,ua,!1))return Sa;
return-1};t.prototype.C$i=function(){if(!this.Te.qb(this.currentStateId)||!this.Te.oa(this.currentStateId).fj.length)return L.ULS.sendTraceTag(537170083,0,15,"CalcAsyncEngine::SetSheetNamesAndUsedRanges() No sheets information for StateId:{0} or StateId does not exist in GridCache",this.currentStateId),!1;for(var ua=[],Ca=1;Ca<this.Te.oa(this.currentStateId).fj.length;Ca++){var Sa=this.Te.oa(this.currentStateId).fj[Ca];Sa&&Array.add(ua,Sa.Tla)}this.Am.updateSheetNames(this.currentStateId,ua);this.Am.updateUnusedCells(this.currentStateId,
this.Te.oa(this.currentStateId).z1f);return!0};t.prototype.setNumberFormats=function(){if(this.instantaneousSupportInformationManager){for(var ua=[],Ca=Ol(this.instantaneousSupportInformationManager.Maa),Sa=Ca.next();!Sa.done;Sa=Ca.next())Sa=Sa.value,Sa=excelOnlineCalc.calc.numberFormat(Sa.IfmtIndex,Sa.FormatString,Sa.Builtin),Array.add(ua,Sa);this.Am.setNumberFormats(ua,!0)}};t.prototype.c7i=function(){if(this.instantaneousSupportInformationManager&&this.instantaneousSupportInformationManager.Fe){var ua=
this.YVh();if(!this.knd||ua)this.i0b(),this.instantaneousSupportInformationManager.Fe.TrueValueString&&(this.trueName=this.instantaneousSupportInformationManager.Fe.TrueValueString),this.instantaneousSupportInformationManager.Fe.FalseValueString&&(this.falseName=this.instantaneousSupportInformationManager.Fe.FalseValueString),ua=Na.CalcHelper.Mve(this.instantaneousSupportInformationManager,ua),this.Am.setLocale(ua),this.knd=!0}};t.prototype.raj=function(){var ua=null;if(void 0!==this.Kc.workbookContext.TimeZoneInformation&&
null!==this.Kc.workbookContext.TimeZoneInformation){ua=null;this.Kc.workbookContext.TimeZoneInformation.StandardDate.Month&&(ua=excelOnlineCalc.date.dateTime(this.Kc.workbookContext.TimeZoneInformation.StandardDate.Year,this.Kc.workbookContext.TimeZoneInformation.StandardDate.Month,this.Kc.workbookContext.TimeZoneInformation.StandardDate.Day,this.Kc.workbookContext.TimeZoneInformation.StandardDate.Hour,this.Kc.workbookContext.TimeZoneInformation.StandardDate.Minute,this.Kc.workbookContext.TimeZoneInformation.StandardDate.Second,
this.Kc.workbookContext.TimeZoneInformation.StandardDate.DayOfWeek+1,this.Kc.workbookContext.TimeZoneInformation.StandardDate.Milliseconds,3));var Ca=null;this.Kc.workbookContext.TimeZoneInformation.DaylightDate.Month&&(Ca=excelOnlineCalc.date.dateTime(this.Kc.workbookContext.TimeZoneInformation.DaylightDate.Year,this.Kc.workbookContext.TimeZoneInformation.DaylightDate.Month,this.Kc.workbookContext.TimeZoneInformation.DaylightDate.Day,this.Kc.workbookContext.TimeZoneInformation.DaylightDate.Hour,
this.Kc.workbookContext.TimeZoneInformation.DaylightDate.Minute,this.Kc.workbookContext.TimeZoneInformation.DaylightDate.Second,this.Kc.workbookContext.TimeZoneInformation.DaylightDate.DayOfWeek+1,this.Kc.workbookContext.TimeZoneInformation.DaylightDate.Milliseconds,3));ua=excelOnlineCalc.date.tzData(this.Kc.workbookContext.TimeZoneInformation.Bias,ua,this.Kc.workbookContext.TimeZoneInformation.StandardBias,Ca,this.Kc.workbookContext.TimeZoneInformation.DaylightBias)}else L.ULS.sendTraceTag(537170082,
0,15,"CalcAsyncEngine.SetWorkbookProperties: TimeZoneInformation is null");ua=excelOnlineCalc.calc.workbookProps(this.Kc.workbookContext.F1904,this.Kc.workbookContext.FDateCompatibility,ua);this.Am.setWorkbookProps(ua)};t.prototype.Rpf=function(){this.setNumberFormats()};t.prototype.jd=function(){L.ULS.sendTraceTag(537170081,0,50,"CalcAsyncEngine.OnWorkbookOpened() called");this.Te=new mb.a;this.currentStateId=this.pp=-1;this.yra="";this.zob=null;this.Szd=!1;this.Am&&this.clearCache()};t.prototype.Gma=
function(){var ua=this;xb.EwaSettings.ka(312)&&Yb.c(excelOnlineCalc.worker.runSmokeTest(1/0,this.MUf,!0)).continueWith(function(Sa){Sa.Cg?L.ULS.sendTraceTag(537170079,0,15,"CalcAsyncEngine.TryInitialize: calc smoke test failed: {0}",Sa.Cg.toString()):L.ULS.sendTraceTag(537170080,0,50,"CalcAsyncEngine.TryInitialize: calc smoke test ended - a new one should start")});var Ca=xb.EwaSettings.ka(697)?z.local:z.mpj;this.Tzd=Yb.c(excelOnlineCalc.calc.createRecalcService(Ca,lb.a.aja()));this.Tzd.continueWith(function(Sa){Sa.Cg?
L.ULS.sendTraceTag(537170075,0,50,"CalcAsyncEngine.TryInitialize: Calc web worker failed: {0}",Sa.Cg.toString()):(L.ULS.sendTraceTag(537170078,0,50,"CalcAsyncEngine.TryInitialize: Calc web worker is working as expected"),ua.Am=ua.Tzd.result,ua.Am?ua.Sbb(0)?ua.g9i():L.ULS.sendTraceTag(537170077,0,15,"CalcAsyncEngine.TryInitialize: UpdateData failed to initialize"):L.ULS.sendTraceTag(537170076,0,50,"CalcAsyncEngine.TryInitialize: Calc web worker result is null"))})};t.prototype.YVh=function(){var ua=
this.instantaneousSupportInformationManager.Gha;if(!ua||this.Vxd===ua.length)return null;this.Vxd=ua.length;return Na.CalcHelper.Bve(ua)};t.prototype.i0b=function(){this.errorTypeNames=Na.CalcHelper.i0b()};t.prototype.$Vh=function(){if(!(this.Te.qb(this.currentStateId)&&0<this.Te.oa(this.currentStateId).fj.length)){this.Te.ia(this.currentStateId,new y);this.Te.oa(this.currentStateId).fj[0]=new x(null);for(var ua=this.Kc.va,Ca=0;Ca<ua.count;Ca++){var Sa=Object(Fa.a)(Ra.a,ua.getItem(Ca));if(Sa){void 0!==
Sa.sheetId&&null!==Sa.sheetId&&void 0!==Sa.name&&null!==Sa.name&&Sa.sheetId.length&&Sa.sheetName.length||L.ULS.sendTraceTag(537170074,0,15,"CalcAsyncEngine::InitializeGridForStateId() invalid sheet - index:{0} Id:{1} Hash:{2} NameLength:{3}",Ca,Sa.sheetId,Sa.hash,Sa.name?Sa.name.length:-1);var Qb=excelOnlineCalc.calc.sheetName(Sa.sheetId,Sa.name);this.Te.oa(this.currentStateId).fj[Ca+1]=new x(Qb);Qb=Sa.usedRange.eW();Qb=excelOnlineCalc.calc.rangeLocation(0,0,Qb.LastRow,Qb.LastColumn);Sa=excelOnlineCalc.calc.unusedCellsUpdate(Sa.sheetId,
Qb);Array.add(this.Te.oa(this.currentStateId).z1f,Sa)}else L.ULS.sendTraceTag(537170073,0,15,"CalcAsyncEngine.InitializeGridForStateId(): not sheet item for StateId:{0} sheet-index:{1}",this.currentStateId,Ca)}}};t.prototype.OKg=function(){for(var ua=Ol(this.Te),Ca=ua.next();!Ca.done;Ca=ua.next())Ca=Ca.value,Ca.key<this.pp&&this.Te.remove(Ca.key)};t.prototype.sbd=function(ua){ua=ua.value||ua.text;if(void 0===ua||null===ua)ua="";return ua};t.prototype.l1f=function(){if(!this.Te.qb(this.currentStateId))return!1;
var ua=!1;Y.a.forEach(this.Te.oa(this.currentStateId).AXa,function(Ca,Sa){Sa.Mpc||(ua=!0)},null);return ua};t.prototype.rZc=function(ua){var Ca={};Ca.reason=ua;Ca.kind=1;return Ca};t.prototype.tcc=function(){return this.Te.qb(this.currentStateId)&&this.Te.oa(this.currentStateId).fj&&this.Te.oa(this.currentStateId).fj[0]&&this.Te.oa(this.currentStateId).fj[0].G4?!0:!1};t.RSg=function(ua){var Ca=[];if(ua&&ua.Y8){ua=Ol(ua.Y8);for(var Sa=ua.next();!Sa.done;Sa=ua.next())Sa=Sa.value,Sa=excelOnlineCalc.calc.columnData(Sa.key,
Sa.value),Array.add(Ca,Sa)}return Ca};t.Zki=function(ua,Ca){if(ua.type!==Ca.type||ua.attributes!==Ca.attributes||!ab.a.equals(ua.fullName,Ca.fullName,!1)||!ua.range.equals(Ca.range))return!1;if(!ua.QF&&!Ca.QF)return!0;if(!ua.QF||!Ca.QF||ua.QF.Y8.count!==Ca.QF.Y8.count)return!1;var Sa={};ua=Ol(ua.QF.Y8);for(var Qb=ua.next();!Qb.done;Sa={$cb:Sa.$cb,gdb:Sa.gdb},Qb=ua.next())if(Sa.$cb=Qb.value,Sa.gdb=void 0,!(Sa.$cb.value&&function(Hb){return function(){var Db=Ca.QF.Y8.zc(Hb.$cb.key);Hb.gdb=Db.value;
return Db}}(Sa)().returnValue&&Sa.gdb&&ab.a.equals(Sa.$cb.value,Sa.gdb,!1)))return!1;return!0};t.LOc=function(ua,Ca,Sa){var Qb=t.cT("NamedObject",Ca.sheetId,Ca.range.top-1,Ca.range.left-1,Ca.range.bottom-1,Ca.range.right-1);if(2===Ca.type){var Hb=!!(Ca.attributes&16),Db=!!(Ca.attributes&8);Ca=t.RSg(Ca.QF);Qb=excelOnlineCalc.calc.namedTableData(Qb,Hb,Db,Ca);ua=excelOnlineCalc.calc.namedObject(ua,Qb)}else Qb=excelOnlineCalc.calc.namedRangeData(Qb),ua=excelOnlineCalc.calc.namedObject(ua,Qb);Array.add(Sa,
ua)};t.zOe=function(ua){var Ca=Sys.Serialization.JavaScriptSerializer.serialize(ua.getRowNumbers());ua=Sys.Serialization.JavaScriptSerializer.serialize(ua.getColumnNumbers());return Ca+ua};t.j0b=function(ua){var Ca=null;if(1<ua.length)for(var Sa=1;Sa<ua.length;Sa++)for(var Qb=0;ua[Sa-1]+1+Qb<ua[Sa];)Ca=Ca||[],Array.add(Ca,ua[Sa-1]+Qb),Qb++;return Ca};t.JKe=function(ua,Ca){if(!Ca)return null;for(var Sa=0,Qb=Ca.length;Sa<Qb;++Sa)if(ab.a.equals(ua,Ca[Sa].Name,!1))return Ca[Sa];return null};t.cT=function(ua,
Ca,Sa,Qb,Hb,Db){function jc(sb,fb,Qa,cb){(0>Qa||Qa>=cb)&&L.ULS.sendTraceTag(537170072,0,15,"CalcAsyncEngine::CreateSheetRangeLocation() callerId:{0} invalid {1}:{2}",sb,fb,Qa)}void 0!==Ca&&null!==Ca||L.ULS.sendTraceTag(537170071,0,15,"CalcAsyncEngine::CreateSheetRangeLocation() callerId:{0} sheetId is null",ua);jc(ua,"top",Sa,t.rff);jc(ua,"left",Qb,t.opd);jc(ua,"bottom",Hb,t.rff);jc(ua,"right",Db,t.opd);return excelOnlineCalc.calc.sheetRangeLocation(Ca,Sa,Qb,Hb,Db)};t.rff=1048576;t.opd=16384;Object(F.a)(t,
"CalcAsyncEngine",null,[6]);Object(F.a)(w,"AbsoluteRelativeReferenceInfo",null,[]);var oc=b(1116),zb=b(25);v.lxf="#";Object(F.a)(v,"Operators",null,[]);var uc=b(1117);h.sheet="Sheet";h.sheetRange="SheetRange";h.document="Document";h.SSh="Ident";Object(F.a)(h,"TraverseFormulaQualifierTypes",null,[]);var P=b(1118),lc=b(1007),Ec=b(905),tc=b(51),cc=b(61);r.prototype.dispose=function(){var ua=this;L.ULS.sendTraceTag(537170064,0,50,"CalcManager.Dispose called");this.$.ea.$a(268,function(Ca){Ca.rCd(Object(V.a)(ua,
ua.zic,"onLocaleInformationAvailable"));Ca.hCd(Object(V.a)(ua,ua.gic,"onFunctionsInfoReady"))});this.gridView&&(this.gridView.Cs(Object(V.a)(this,this.onContentReady,"onContentReady")),this.gridView.Ca&&this.gridView.Ca.LEf(Object(V.a)(this,this.gkf,"onBlockPresent")),this.Ix=null);this.Lif=this.Iif=this.fAc=null};r.prototype.KGg=function(ua,Ca,Sa,Qb){Qb=void 0===Qb?null:Qb;this.il&&(xb.EwaSettings.isChangeGateEnabled("OfficeVSO:5470583_Calculate_Formula_Refactoring")?this.il.HGg(ua,Ca,Sa,Qb):this.il.JGg(ua,
Ca,Sa,Qb))};r.prototype.evalFormula=function(ua){return this.il?this.il.evalFormula(ua):Promise.reject("calc engine not initialized")};r.prototype.evalFormulaRange=function(ua,Ca,Sa){return this.il?this.il.evalFormulaRange(ua,Ca,Sa):Promise.reject("calc engine not initialized")};r.prototype.dqb=function(ua,Ca,Sa,Qb){return this.il?this.il.dqb(ua,Ca,Sa,Qb):Promise.reject("CalcEngine is null")};r.prototype.Tsb=function(ua){return this.il?(L.ULS.shipAssertTag(537170059,0,2===ua.type,"CalcManager.GetTableHeaders() - ActiveItem is not a table"),
this.il.Tsb(ua)):null};r.prototype.nwg=function(ua,Ca){if(!Ca||2!==ua.type)return!1;ua=Wa.a(ua);return ua.right-ua.left+1===Ca.count};r.prototype.pJe=function(ua){if(!this.UBb)return this.w5f||L.ULS.sendTraceTag(537170057,0,15,"CalcManager.ExtractReferenceWrappers - parser not initialized"),null;var Ca=this.ira(zb.Range.ld(1,1));Ca=this.UBb.parseFormula(excelOnlineCalc.parse.parseLocals(1,Ca.range),ua);if(!excelOnlineCalc.parse.parseResultHelper.isSuccess(Ca))return L.ULS.sendTraceTag(537170056,0,
10,"CalcManager.ExtractReferenceWrappers - ParseFormula failed"),null;try{if(xb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.StructuredReferencesHighlighting",!1)){var Sa=this.gridView.ga.wa.activeCell,Qb=excelOnlineCalc.location.gridCell(Sa.top-1,Sa.left-1),Hb=excelOnlineCalc.location.documentLoc("",this.$.workbookContext.FullDocumentInfo.BreadcrumbDocName),Db=excelOnlineCalc.location.sheetIndex(Hb,this.$.va.qa.sheetId),jc=this.jXg(Qb,Db);this.lEd||(this.lEd=excelOnlineCalc.util.createResolver(this.iXg()));
var sb=excelOnlineCalc.parse.parseResultHelper.extractReferences(Ca,this.ar.config.localeInfo,xb.EwaSettings.ka(629),jc,this.lEd)}else sb=excelOnlineCalc.parse.parseResultHelper.extractReferences(Ca,this.ar.config.localeInfo,xb.EwaSettings.ka(629));xb.EwaSettings.ka(102)&&this.zyj(sb,ua);return sb}catch(fb){return L.ULS.sendTraceTag(537170055,0,10,"CalcManager.ExtractReferenceWrappers - exception: {0}",fb.message),null}};r.prototype.extractLetVariables=function(ua,Ca){if(!this.UBb)return this.w5f||
L.ULS.sendTraceTag(537170054,0,15,"CalcManager.ExtractLetVariables - parser not initialized"),null;var Sa=this.ira(zb.Range.ld(1,1));ua=this.UBb.parseFormula(excelOnlineCalc.parse.parseLocals(1,Sa.range),ua);if(!excelOnlineCalc.parse.parseResultHelper.isSuccess(ua))return L.ULS.sendTraceTag(537170053,0,10,"CalcManager.ExtractLetVariables - ParseFormula failed"),null;try{return excelOnlineCalc.parse.parseResultHelper.extractLetVariables(ua,Ca,this.ar.config.localeInfo)}catch(Qb){return L.ULS.sendTraceTag(537170052,
0,10,"CalcManager.ExtractLetVariables - exception: {0}",Qb.message),null}};r.prototype.extractReferences=function(ua,Ca,Sa){if(!Ca)return L.ULS.sendTraceTag(537170051,0,10,"CalcManager.ExtractReferences - sheetName is null"),null;if(!Sa)return L.ULS.sendTraceTag(537170050,0,10,"CalcManager.ExtractReferences - documentName is null"),null;var Qb=this.pJe(ua);if(!Qb)return L.ULS.sendTraceTag(537170049,0,15,"CalcManager.ExtractReferences - ExtractReferenceWrappers returned null"),null;try{return this.lWg(Qb,
Ca,Sa,ua)}catch(Hb){return L.ULS.sendTraceTag(537170048,0,10,"CalcManager.ExtractReferences - exception: {0}",Hb.message),null}};r.prototype.RIh=function(ua,Ca,Sa,Qb){if(!ua)return L.ULS.sendTraceTag(537170019,0,10,"CalcManager.GetSubExpressionSpanForContextualFormulaPreview - range is null"),null;if(!Ca||0>=Ca.length)return L.ULS.sendTraceTag(537170018,0,10,"CalcManager.GetSubExpressionSpanForContextualFormulaPreview - formula is null/empty"),null;ua=this.ira(ua);if(!this.ar||!ua)return null;var Hb=
this.Hrb(ua).returnValue;if(!Hb||Hb.h3a)return null;Sa=excelOnline.utils.getCharIndexInTextFromPoint(Sa,Qb,xb.EwaSettings.ka(629));return 0>Sa?null:excelOnlineCalc.runtime.getSubExpressionFromFormulaCharacterIndex(this.ar.config,Sa,Ca,ua)};r.prototype.zGg=function(ua,Ca,Sa,Qb){var Hb=this;if(!ua)return L.ULS.sendTraceTag(537170017,0,10,"CalcManager.CalcPartialResultsForFormula - range is null"),null;var Db=null;return this.evalFormula(Ca).then(function(jc){var sb=Hb.ar.$9g(jc,Sa),fb=sb.returnValue;
8!==sb.kind||fb.length&&fb!==Na.CalcHelper.unknownError?jc=0:(L.ULS.sendTraceTag(537170016,0,50,"EvalSession.GetPartialResultValueForFormula - EvalResultToString error"),jc=excelOnlineCalc.calc.getEvalFailureReason(jc),void 0!==jc&&null!==jc||L.ULS.shipAssertTag(537170015,0,!1,"CalcHelper.GetEvalFailureReason() - result is not a failure, function should not be called"),jc=1);return Db=Qb?new oc.a(fb,Qb.start,Qb.end,jc):new oc.a(fb,-1,-1,jc)},function(jc){L.ULS.sendTraceTag(537170014,0,10,"EvalSession.GetPartialResultValueForFormula - exception: {0}",
jc);return Promise.resolve(Db)})};r.prototype.getSubExpressionSpan=function(ua){return this.ar&&ua?excelOnlineCalc.runtime.getSubExpressionSpan(ua):null};r.prototype.getFormulaSubExpressionObject=function(ua,Ca,Sa){return this.ar&&ua&&Ca&&Sa?excelOnlineCalc.runtime.getFormulaSubExpressionObject(this.ar.config,Ca,Sa,this.ira(ua)):null};r.prototype.UIh=function(ua,Ca,Sa){return this.ar&&ua&&Ca?excelOnlineCalc.runtime.getSubstitutedSubExpressionString(this.ar.config,Ca,Sa,this.ira(ua)):null};r.prototype.SIh=
function(ua,Ca,Sa){return this.ar&&ua&&Ca?excelOnlineCalc.runtime.getSubExpressionSubspans(this.ar.config.localeInfo,Ca,Sa):null};r.prototype.GCh=function(){return this.ar?this.ar.config.localeInfo.listSeparator:null};r.prototype.isFormulaSubExpressionVolatile=function(ua){return this.ar?excelOnlineCalc.runtime.isFormulaSubExpressionVolatile(this.ar.config.localeInfo,ua):!1};r.prototype.ira=function(ua){return ua&&this.ar?this.ar.IXg(this.ar.wZg(),ua.top-1,ua.left-1):null};r.prototype.g2h=function(ua,
Ca){ua=this.B$c(ua);if(void 0===ua||null===ua)return null;ua=this.aq.createFormat(ua.FormatString,ua.Builtin);if(!excelOnlineCalc.util.isSuccess(ua))return null;Ca=this.aq.parseEdit(Ca,ua.value);return excelOnlineCalc.util.isSuccess(Ca)?Ca.value.kind===lc.a.formula:null};r.prototype.A$c=function(ua){if(!ua.isValid())return L.ULS.sendTraceTag(537170013,0,50,"CalcManager.GetNumberFormat: invalid format was given! ifmt: {0}, format string: {1}, format obj: {2}",null!=ua.MD?ua.MD.toString():"null",ua.formatString?
ab.a.wI(ua.formatString):"null",ua.numberFormat?"!null":"null"),null;var Ca=ua.uBh();if("String"===Object.getType(Ca).getName())var Sa=this.Lif;else if("Number"===Object.getType(Ca).getName())Sa=this.Iif;else return L.ULS.sendTraceTag(537170012,0,10,"CalcManager.GetNumberFormat: key is of unknown type!"),null;Ca=Ca.toString();if(Ca in Sa)return Sa[Ca].numberFormat;Sa[Ca]=ua;return ua.numberFormat};r.prototype.getWorksheetFuncId=function(ua){return this.localeInfo.getWorksheetFuncId(ua)};r.prototype.lWg=
function(ua,Ca,Sa,Qb){for(var Hb=xb.EwaSettings.ka(734),Db={Items:[]},jc=0;jc<ua.length;jc++){var sb=ua[jc],fb={};fb.Start=sb.span.start;fb.End=sb.span.end;if(Hb&&sb.kind===uc.a.func)fb.End=sb.span.start+sb.ref.name.length,Array.add(Db.Items,{Span:fb,IsFunction:!0});else if(Hb&&sb.kind===uc.a.Iai)sb=sb.ref.value.oper.kind,Array.add(Db.Items,{Span:fb,IsString:2===sb,IsBoolean:4===sb,IsNumber:1===sb});else if(this.c5g(sb,Ca,Sa)){var Qa=new w,cb=this.dGh(sb,Ca,Qa,Qb);if(xb.EwaSettings.ka(629)){var Ab=
this.wCh(sb),gc=this.vCh(sb);if(cb||gc&&0<=Ab)fb={Span:fb,LetNumber:Ab,LetName:gc,Range:cb},fb.IsRangeRef=Qa.Q3a,fb.IsAbsoluteFirstRow=Qa.Bua,fb.IsAbsoluteFirstColumn=Qa.Aua,fb.IsAbsoluteSecondRow=Qa.FJa,fb.IsAbsoluteSecondColumn=Qa.EJa,fb.IsStructRef=sb.kind===uc.a.IMd,Array.add(Db.Items,fb)}else cb&&(fb={Span:fb,Range:cb},fb.IsRangeRef=Qa.Q3a,fb.IsAbsoluteFirstRow=Qa.Bua,fb.IsAbsoluteFirstColumn=Qa.Aua,fb.IsAbsoluteSecondRow=Qa.FJa,fb.IsAbsoluteSecondColumn=Qa.EJa,fb.IsStructRef=sb.kind===uc.a.IMd,
Array.add(Db.Items,fb))}}Db.Items.sort(function(Lc,Nc){return Lc.Span.Start-Nc.Span.Start});return Db};r.prototype.wCh=function(ua){return ua.kind===uc.a.Maf?ua.ref.number:-1};r.prototype.vCh=function(ua){return ua.kind===uc.a.Maf?ua.ref.name:null};r.prototype.dGh=function(ua,Ca,Sa,Qb){if(ua.kind===uc.a.range)return Sa.Q3a=!0,this.Ute(ua,Ca,Sa,Qb);if(ua.kind===uc.a.namedRange){Sa=ua.ref;(ua=this.$.wb.getItemByName(Sa.name))||(ua=this.$.wb.getItemByName(Ca+"!"+Sa.name));if(!(ua&&ua.sheetName&&ua.usedRange&&
ab.a.equals(ua.sheetName,Ca,!0)))return null;Ca=2===ua.type?Wa.a(ua):ua.usedRange;return ha.m(Ca,ua)}if(ua.kind===uc.a.IMd){var Hb=ua.ref,Db;Hb.name?(Db=this.$.wb.getItemByName(Hb.name))||(Db=this.$.wb.getItemByName(Ca+"!"+Hb.name)):Db=this.gridView.$b.Mk(this.gridView.ga.wa.activeCell);if(!(Db&&Db.sheetName&&Db.usedRange&&ab.a.equals(Db.sheetName,Ca,!0)))return null;Sa.Q3a=!1;return this.Ute(ua,Ca,Sa,Qb)}return null};r.prototype.Ute=function(ua,Ca,Sa,Qb){ua=ua.ref;if(ua.type){if(ua.type===P.a.column){var Hb=
ua.startIndex;ua=ua.endIndex;Sa.Aua=Hb.kind===Ec.a.abs;Sa.EJa=ua.kind===Ec.a.abs;return this.createRange(0,Hb.index,U.a.lh,ua.index,Ca)}if(ua.type===P.a.row)return Hb=ua.endIndex,Sa.Bua=ua.startIndex.kind===Ec.a.abs,Sa.FJa=Hb.kind===Ec.a.abs,this.createRange(ua.startIndex.index,0,ua.endIndex.index,U.a.zh,Ca);if(ua.type===P.a.cell){Hb=ua.row;var Db=ua.col;Sa.Bua=Sa.FJa=Hb.kind===Ec.a.abs;Sa.Aua=Sa.EJa=Db.kind===Ec.a.abs;return this.KYb(ua.span.end,Qb)&&(Sa=zb.Range.ld(Hb.index+1,Db.index+1),Sa=this.gridView.$b.PUe(Sa))?
ha.n(Sa,Ca):this.createRange(Hb.index,Db.index,Hb.index,Db.index,Ca)}if(ua.type===P.a.range){Hb=ua.top;Db=ua.left;Qb=ua.bottom;ua=ua.right;var jc=Math.min(Hb.index,Qb.index),sb=Math.min(Db.index,ua.index),fb=Math.max(Hb.index,Qb.index),Qa=Math.max(Db.index,ua.index);Sa.Bua=Hb.kind===Ec.a.abs;Sa.FJa=Qb.kind===Ec.a.abs;Sa.Aua=Db.kind===Ec.a.abs;Sa.EJa=ua.kind===Ec.a.abs;return this.createRange(jc,sb,fb,Qa,Ca)}L.ULS.sendTraceTag(537170010,0,10,"CalcManager.CovertFormulaRefToRange: Unsupported formula ref type '{0}'",
ua.type);return null}L.ULS.sendTraceTag(537170011,0,15,"CalcManager.CovertFormulaRefToRange: traverseFormulaRef.Type is null");return null};r.prototype.KYb=function(ua,Ca){return Ca.length>=ua&&0<ua&&Ca.charAt(ua-1)===v.lxf};r.prototype.EGg=function(ua,Ca,Sa){this.il&&this.il.IGg(ua,Ca,Sa)};r.prototype.B$c=function(ua){return this.instantaneousSupportInformationManager&&this.instantaneousSupportInformationManager.Maa&&this.instantaneousSupportInformationManager.Maa[ua]&&this.aq?this.instantaneousSupportInformationManager.Maa[ua]:
null};r.prototype.toXLNumber=function(ua){if(!this.aq)return null;ua=excelOnlineCalc.numfmt.toXLNumber(this.config.mathpack,this.aq,ua);return excelOnlineCalc.util.isSuccess(ua)?ua.value:null};r.prototype.zyj=function(ua,Ca){if(ua){ua=Ol(ua);for(var Sa=ua.next();!Sa.done;Sa=ua.next())if(Sa=Sa.value,Sa.ref.type&&Sa.ref.type===P.a.cell){var Qb=Sa.ref;r.uHi(Qb,Ca)&&(Qb.span.end+=1,Sa.span.end+=1)}}};r.prototype.createRange=function(ua,Ca,Sa,Qb,Hb){var Db={};Db.FirstRow=ua;Db.FirstColumn=Ca;Db.LastRow=
Sa;Db.LastColumn=Qb;Db.SheetName=Hb;return Db};r.prototype.c5g=function(ua,Ca,Sa){var Qb=ua.ref.qualifier;if(!Qb)return!0;switch(ua.ref.qualifier.type){case h.sheet:return ua=Qb.document,ab.a.equals(Qb.sheet,Ca,!0)&&(!ua||ab.a.equals(ua.document,Sa,!0));case h.sheetRange:return Ca=this.$.va.getItemByName(Ca),Sa=this.$.va.getItemByName(Qb.sheet1),Qb=this.$.va.getItemByName(Qb.sheet2),!!Ca&&!!Sa&&!!Qb&&(Sa.index<=Ca.index&&Ca.index<=Qb.index||Qb.index<=Ca.index&&Ca.index<=Sa.index);case h.document:return ab.a.equals(Qb.document,
Sa,!0);case h.SSh:return Qb=Qb.name,ab.a.equals(Qb,Ca,!0)||ab.a.equals(Qb,Sa,!0);default:return L.ULS.sendTraceTag(537170009,0,10,"CalcManager.GetQualifierData: Unsupported formula qualifier type '{0}'",Qb.type),!1}};r.prototype.htj=function(ua){this.instantaneousSupportInformationManager=ua;ua.Maa.length&&ua.Gha.length?(this.fAc=new Na.CalcHelper(this.gridView.$),this.UBb=this.ar.createParser(),this.p5d=this.ar.createNumberFormatter(),this.u3e=!0,L.ULS.sendTraceTag(537170007,0,50,"CalcManager.TryInitializeInternal: calc initialized"),
this.il||(L.ULS.sendTraceTag(537170006,0,50,"CalcManager creating calc engine"),this.il=new t(this.$))):L.ULS.sendTraceTag(537170008,0,15,"CalcManager.TryInitializeInternal: IInstantaneousSupportInformationManager locale information missing, cannot initialize calc. number formats count = {0}, functions info count = {1}",ua.Maa.length,ua.Gha.length.toString())};r.prototype.zic=function(ua){L.ULS.sendTraceTag(537170005,0,50,"CalcManager.OnLocaleInformationAvailable() called");ua.rCd(Object(V.a)(this,
this.zic,"onLocaleInformationAvailable"));ua.Gha.length?this.gic(ua,Sys.EventArgs.Empty):(L.ULS.sendTraceTag(537170004,0,50,"CalcManager.OnLocaleInformationAvailable() - waiting for functions information"),ua.vfe(Object(V.a)(this,this.gic,"onFunctionsInfoReady")))};r.prototype.gic=function(ua){L.ULS.sendTraceTag(537170003,0,50,"CalcManager.OnFunctionsInfoReady called");ua.hCd(Object(V.a)(this,this.gic,"onFunctionsInfoReady"));this.htj(ua)};r.prototype.onContentReady=function(){var ua=this;this.il&&
(this.instantaneousSupportInformationManager&&this.instantaneousSupportInformationManager.Mfd||tc.Task.delay(0).CWCT(function(){ua.il.Sbb(1)},null,0,cc.a.current))};r.prototype.gkf=function(ua,Ca){this.il&&(this.instantaneousSupportInformationManager&&this.instantaneousSupportInformationManager.Mfd||this.il.Rwe(Ca.Ed.block))};r.prototype.Hrb=function(ua){if(!ua)return{returnValue:null,emptyCell:!1};var Ca=this.getSheetName(ua.sheet.index);if(!Ca)return L.ULS.sendTraceTag(537169998,0,50,"CalcManager.GetCellFromBlockCache: No sheet index {0}",
ua.sheet.index),{returnValue:null,emptyCell:!1};var Sa=r.convertToRange(ua);Ca=this.gridView.Hrb(Ca,Sa.top,Sa.left);return Ca?Ca.Y4g?{returnValue:Ca,emptyCell:!1}:(L.ULS.sendTraceTag(537169996,0,50,"CalcManager.GetCellFromBlockCache: cell {0} {1} is empty",ua.range.row,ua.range.col),{returnValue:null,emptyCell:!0}):(L.ULS.sendTraceTag(537169997,0,50,"CalcManager.GetCellFromBlockCache: cellProxy is null for cell {0} {1}",ua.range.row,ua.range.col),{returnValue:null,emptyCell:!1})};r.prototype.getSheetName=
function(ua){var Ca=this.gridView.$.va.getItem(ua);return Ca?Ca.sheetName:(L.ULS.sendTraceTag(537169995,0,50,"CalcManager.GetSheetName - no sheet in index {0}",ua),null)};r.prototype.jXg=function(ua,Ca){var Sa={allowUnqualifiedCell:!0,wrapCellReferences:!0};Sa.config=this.ar.config;Sa.originGridCell=excelOnlineCalc.util.success(ua);Sa.originSheet=excelOnlineCalc.util.success(Ca);return Sa};r.prototype.iXg=function(){var ua={};ua.config=this.ar.config;ua.getNameLoc=Object(V.a)(this.il,this.il.getNameLoc,
"getNameLoc");ua.getContainingTable=Object(V.a)(this.il,this.il.getContainingTable,"getContainingTable");ua.getStructRefColumn=Object(V.a)(this.il,this.il.getStructRefColumn,"getStructRefColumn");ua.getStructRefSpecialRef=Object(V.a)(this.il,this.il.getStructRefSpecialRef,"getStructRefSpecialRef");ua.getDocumentLoc=Object(V.a)(this.il,this.il.getDocumentLoc,"getDocumentLoc");ua.getSheetIndex=Object(V.a)(this.il,this.il.getSheetIndex,"getSheetIndex");ua.getSheetName=Object(V.a)(this.il,this.il.getSheetName,
"getSheetName");ua.getUserDefinedFuncLoc=Object(V.a)(this.il,this.il.getUserDefinedFuncLoc,"getUserDefinedFuncLoc");ua.getSheetRangeIndexes=Object(V.a)(this.il,this.il.getSheetRangeIndexes,"getSheetRangeIndexes");return ua};r.uHi=function(ua,Ca){return Ca.length>ua.span.end&&Ca.charAt(ua.span.end)===v.lxf};r.convertToRange=function(ua){return zb.Range.ld(ua.range.row+1,ua.range.col+1)};Ll.Object.defineProperties(r.prototype,{ar:{configurable:!0,enumerable:!0,get:function(){return this.fAc}},gridView:{configurable:!0,
enumerable:!0,get:function(){return this.Ix}},$:{configurable:!0,enumerable:!0,get:function(){return this.ub}},aq:{configurable:!0,enumerable:!0,get:function(){return this.p5d}},localeInfo:{configurable:!0,enumerable:!0,get:function(){return this.ar?this.ar.config.localeInfo:null}},config:{configurable:!0,enumerable:!0,get:function(){return this.ar.config}}});Object(F.a)(r,"CalcManager",null,[427,6]);var Zb=aa.a;Em(n,Zb);n.prototype.create=function(){var ua=this;if(this.$){L.ULS.sendTraceTag(537169993,
0,50,"CalcManagerFactory.Create: Start loading script");if(xb.EwaSettings.isChangeGateEnabled("OfficeVSO:5543503_loadCalcCurrentVersion")){var Ca=54;var Sa="Current"}else Ca=57,Sa="Stable";L.ULS.sendTraceTag(537169992,0,50,"CalcManagerFactory.Create: Calc {0} JS was loaded",Sa);fa.TaskExtensions.Aa(W.a.loadScript(Ca,4,this.rb,void 0,void 0,265),function(){L.ULS.sendTraceTag(537169991,0,50,"CalcManagerFactory.Create: Raised create service event");var Qb=ua.$.ea.Ba(266,!1);Qb||(L.ULS.sendTraceTag(537169990,
0,50,"CalcManagerFactory.Create: CalcManager is not registered, creating new CalcManager"),Qb=new r(ua.$));ua.Eb(Qb)},this.la,3)}else L.ULS.sendTraceTag(537169994,0,50,"CalcManagerFactory.Create: ewaControl is null, cann't create the service")};n.ja=function(ua){ua&&ua.ea&&ua.ea.Ia(265,new n(ua))};Object(F.a)(n,"CalcManagerFactory",aa.a,[]);var Aa=b(4),Ia=b(315);Object(F.a)(l,"MarqueeMetadata",null,[]);var qb=b(129),wb=b(638),ic=b(333);d.prototype.iW=function(ua,Ca){this.t3h&&ua.textBox.addEventLogRecord("ColoredReferencesManager.TryUpdateColoredReferences");
if(this.qXf||ua.aM)return!1;var Sa=void 0!==Ca&&null!==Ca?Ca:ua.text;if(this.calcManager&&1<Sa.length&&Ka.e(Sa)){var Qb=this.P$c(),Hb=this.ZSe(),Db=this.Kc.workbookContext.WorkbookFileName,jc=!1,sb=.01>Math.random()?Object(Fa.a)(qb.a,this.Kc.Vb.Dc("LoadingUIShown","ColoredReferencesManager")):null;try{var fb=this.calcManager.extractReferences(Sa,Hb,Db);if(!fb)return L.ULS.sendTraceTag(537169989,0,50,"ColoredReferencesManager.UpdateColoredReferences: extractReferences is null (might be an invalid formula)"),
!1;Hb=[];Db=[];for(var Qa=[],cb=[],Ab=0,gc=0,Lc=new ib.a(!1),Nc="",yd=Ol(fb.Items),Od=yd.next();!Od.done;Od=yd.next()){var sa=Od.value;jc=sa.IsStructRef||jc;if(sa.IsBoolean||sa.IsNumber||sa.IsString){var vb=sa.IsBoolean?d.cCg:sa.IsNumber?d.Gmi:d.xmj;this.JDa(Db,Sa,Ab,sa.Span.Start,null);this.JDa(Db,Sa,sa.Span.Start,sa.Span.End,vb);Ab=sa.Span.End}else if(xb.EwaSettings.ka(629)){if(sa.Range||sa.LetName&&0<=sa.LetNumber){fb=null;if(sa.Range){var Lb=ha.D(sa.Range);fb=this.Nrb(Lb,Lc,1);Array.add(Hb,new ic.a(Lb,
Qb))}else sa.LetName&&0<=sa.LetNumber&&(fb=Nc=this.jwh(sa.LetName,sa.LetNumber,Lc,Nc),gc!==Lc.count&&ua.colors.add(sa.Span.Start+"-"+sa.Span.End,this.colors[(Lc.count-1)%this.colors.length]));this.JDa(Db,Sa,Ab,sa.Span.Start,null);this.JDa(Db,Sa,sa.Span.Start,sa.Span.End,fb);Ab=sa.Span.End;Array.add(Qa,sa.Span);var rc=Db.length-1;Array.add(cb,new l(rc,Db[rc].text,sa));gc=Lc.count}}else if(sa.Range){var Oc=ha.D(sa.Range),Bb=this.Nrb(Oc,Lc,1);this.JDa(Db,Sa,Ab,sa.Span.Start,null);this.JDa(Db,Sa,sa.Span.Start,
sa.Span.End,Bb);Array.add(Hb,new ic.a(Oc,Qb));Ab=sa.Span.End;Array.add(Qa,sa.Span);var hc=Db.length-1;Array.add(cb,new l(hc,Db[hc].text,sa))}}this.JDa(Db,Sa,Ab,Sa.length,null);this.Y$i(ua,Db,!!Ca);var Pc=ua.textBox.text;if(!ab.a.equals(Pc,Sa,!1)){L.ULS.shipAssertTag(38114182,0,!1,"ColoredReferencesManager.UpdateColoredReferences: The text we created is different from the original text. Setting the original text back. currentTextLength [{0}], originalTextLength [{1}]",Pc.length,Sa.length);var rd=ua.textBox.caretPosition;
ua.textBox.text=Sa;ua.textBox.caretPosition=rd;return!0}this.u$b(Hb,Lc,cb);xb.EwaSettings.ka(629)&&0<Hb.length&&L.ULS.sendTraceTag(537169988,0,50,"ColoredReferencesManager.UpdateColoredReferences: Cell reference(s) colored");xb.EwaSettings.ka(629)&&0<ua.colors.count&&L.ULS.sendTraceTag(537169987,0,50,"ColoredReferencesManager.UpdateColoredReferences: Let name(s) colored");return this.z2a=!0}finally{sb&&sb.Yya(function(){jc&&L.ULS.sendTraceTag(537169986,0,50,"ColoredReferencesManager.UpdateColoredReferences: Formula with structured reference is highlighted in {0} ms",
sb.Cc)})}}else return this.u$b(null,null),this.z2a&&(this.z2a=!1,Qb=ua.textBox.caretPosition,ua.textBox.setPlainText(Sa),ua.textBox.caretPosition=Math.min(Qb,Sa.length),Ca)?!0:!1};d.prototype.ygf=function(ua,Ca,Sa){if(!ua||!Ca||!Sa)return L.ULS.shipAssertTag(537169985,0,!!ua,"ColoredReferencesManager.MoveMarqueeRange: cellContentEditor is null"),L.ULS.shipAssertTag(537169984,0,!!Ca,"ColoredReferencesManager.MoveMarqueeRange: highlightState is null"),L.ULS.shipAssertTag(537169955,0,!!Sa,"ColoredReferencesManager.MoveMarqueeRange: newRange is null"),
!1;var Qb=Object(Fa.a)(l,Ca.metadata);if(!Qb)return L.ULS.shipAssertTag(537169954,0,!1,"ColoredReferencesManager.MoveMarqueeRange: marqueeMetadata is null"),!1;var Hb=Qb.Zoj,Db=Qb.sYf,jc=this.gridView.$b.t4e(Sa)?Sa.u7b(Qb.Aua,Qb.Bua):Sa.f1a(Qb.Aua,Qb.Bua,Qb.EJa,Qb.FJa);if(!jc)return L.ULS.shipAssertTag(537169953,0,!1,"ColoredReferencesManager.MoveMarqueeRange: newText is null"),!1;var sb=Db.indexOf("!");-1!==sb&&(jc=Db.substring(0,sb+1)+jc);if(!ua.textBox.changeTextInExistingTextPart(Hb,Db,jc))return L.ULS.shipAssertTag(38926105,
0,!1,"ColoredReferencesManager.MoveMarqueeRange: failed to change the text part"),!1;Qb.sYf=jc;Hb=!0;for(Db=1;4>=Db;Db++)(jc=ta.g(this.Kc).Kb.hJ(3,Db,Ca.Z8))?(jc.range=Sa,jc.metadata=Qb):(L.ULS.shipAssertTag(537169952,0,!1,"ColoredReferencesManager.MoveMarqueeRange: highlightStateInPane is null"),Hb=!1);this.gridView.Kb.update(!1,!1);this.gridView.uc.nj&&(this.gridView.uc.textBox.text=ua.text);this.gridView.uc.XCb(new Ia.a(!0));return Hb};d.prototype.y3h=function(ua){if(3!==ua.Dq)return L.ULS.shipAssertTag(537169951,
0,!1,"ColoredReferencesManager.IsMarqueeHighlightDragable: not HighlightDivIndex.Marquee."),!1;ua=Object(Fa.a)(l,ua.metadata);return ua?ua.Q3a&&!ua.Pcc:(L.ULS.shipAssertTag(537169950,0,!1,"ColoredReferencesManager.IsMarqueeHighlightDragable: marqueeMetadata is null."),!1)};d.prototype.Pab=function(ua,Ca){L.ULS.sendTraceTag(537169949,0,50,"ColoredReferencesManager.SuspendResumeColoredReferences: "+(Ca?"suspending":"resuming")+" colored references");!Ca||this.N8e&&!this.z2a||(this.N8e&&(this.z2a=!1),
this.u$b(null,null),ua.textBox.lLg());this.qXf=Ca};d.prototype.dispose=function(){this.gridView&&this.gridView.Gc&&this.gridView.Gc.Fr(Object(V.a)(this,this.Ozb,"onCellEditEnded"))};d.prototype.RRh=function(ua){var Ca=this.P$c(),Sa=this.ZSe(),Qb=this.Kc.workbookContext.WorkbookFileName,Hb=[],Db=new ib.a(!1),jc=[];if(Sa=this.calcManager.extractReferences(ua,Sa,Qb)){Sa=Ol(Sa.Items);for(Qb=Sa.next();!Qb.done;Qb=Sa.next())if(Qb=Qb.value,Qb.Range){var sb=ha.D(Qb.Range);Array.add(Hb,new ic.a(sb,Ca));this.Nrb(sb,
Db,1);Array.add(jc,new l(Qb.Span.Start,ua.substring(Qb.Span.Start,Qb.Span.End),Qb,!0))}this.u$b(Hb,Db,jc)}};d.prototype.Nrb=function(ua,Ca,Sa){var Qb=Ca.getItem(ua.toString());Qb||(Qb=this.colors[Ca.count%this.colors.length],Ca.add(ua.toString(),Qb));return String.format(Qb,Sa)};d.prototype.jwh=function(ua,Ca,Sa,Qb){ua="["+ua+", "+Ca+"]";Ca=Sa.getItem(ua);Ca||(Ca=Sa.count%this.colors.length,Ca=this.colors[Ca],Qb===String.format(Ca,1)&&(Sa.add("skip-"+ua,Ca),Ca=Sa.count%this.colors.length,Ca=this.colors[Ca]),
Sa.add(ua,Ca));return String.format(Ca,1)};d.prototype.JDa=function(ua,Ca,Sa,Qb,Hb){L.ULS.shipAssertTag(537169948,0,Sa<=Qb,"ColoredReferencesManager.AddTextPart: startIndex cannot be larger than endIndex");Sa<Qb&&(Ca=Ca.substring(Sa,Qb),Array.add(ua,Object.assign(new wb.a,{text:Ca,color:Hb})))};d.prototype.u$b=function(ua,Ca,Sa){var Qb=this;Sa=void 0===Sa?null:Sa;ua&&ua.length?(L.ULS.sendTraceTag(537169947,0,50,"ColoredReferencesManager.HighlightRanges: number of ranges to highlight: "+ua.length),
ua.reverse(),Sa.reverse(),this.gridView.Kb.Hs(ua,[3],!0,function(Hb,Db){if(Hb&&Hb.range&&Db){L.ULS.shipAssertTag(537169943,0,Ca.qb(Hb.range.toString()),"ColoredReferencesManager.HighlightRanges: The range '{0}' doesn't exist in the range to color dictionary",Hb.range.toString());var jc=Qb.Nrb(Hb.range,Ca,.1),sb=Qb.Nrb(Hb.range,Ca,1);Qb.Kc.frame&&Qb.Kc.frame.wG&&Qb.Kc.frame.wG.dja||(Db.style.background=jc);Db.style.borderColor=sb;Sa&&(Db.setAttribute(Aa.a.zub,Hb.Z8.toString()),Hb.metadata=Sa[Hb.Z8])}else L.ULS.shipAssertTag(537169946,
0,!!Hb,"ColoredReferencesManager.HighlightRanges: state is null"),L.ULS.shipAssertTag(537169945,0,!!Hb.range,"ColoredReferencesManager.HighlightRanges: state.Range is null"),L.ULS.shipAssertTag(537169944,0,!!Db,"ColoredReferencesManager.HighlightRanges: div is null")})):(ua=this.Kc.Vb.Dc("UserAction","HideRangesHighlightsStopwatch"),this.gridView.Kb.mk([3]),this.gridView.Kb.BGb(new ic.a(null,this.P$c()),[3]),ua.stop())};d.prototype.Y$i=function(ua,Ca,Sa){var Qb=ua.textBox;Qb.pJ=!0;var Hb=Qb.selection,
Db=Hb.index;Hb=Db+Hb.length;Qb.setTextFromTextParts(Ca);Ca=Qb.text.length;Qb.selectRange(Math.min(Db,Ca),Math.min(Hb,Ca));Sa&&ua.XCb(new Ia.a);Qb.pJ=!1};d.prototype.P$c=function(){return this.YSe().sheetId};d.prototype.ZSe=function(){return this.YSe().sheetName};d.prototype.YSe=function(){return this.gridView.Bs&&this.gridView.Bs.QJ?this.gridView.Bs.QJ:this.Kc.qa};d.prototype.Ozb=function(){this.z2a=!1};d.Gmi="rgba(9, 134, 88, 1)";d.cCg="rgba(0, 0, 255, 1)";d.xmj="rgba(163, 21, 21, 1)";Object(F.a)(d,
"ColoredReferencesManager",null,[429,6]);var Jb=aa.a;Em(e,Jb);e.prototype.create=function(){var ua=this;this.$.ea.$a(266,function(Ca){ua.Eb(new d(ua.$,Ca))})};e.ja=function(ua){ua.ea.Ia(282,new e(ua))};Object(F.a)(e,"ColoredReferencesManagerFactory",aa.a,[]);var Ua=b(919),$a=aa.a;Em(a,$a);a.prototype.create=function(){var ua=this;this.$.ea.$a(266,function(Ca){ua.Eb(new Ua.RelativeAndAbsoluteReferencesManager(Ca))})};a.ja=function(ua){ua.ea.Ia(295,new a(ua))};Object(F.a)(a,"RelativeAndAbsoluteReferencesManagerFactory",
aa.a,[]);Type.registerNamespace("_Ewa");C.a.Ga(A.ja);C.a.Ga(n.ja);C.a.Ga(e.ja);C.a.Ga(a.ja)},905:function(C,F,b){function a(){}b.d(F,"a",function(){return a});C=b(0);a.abs="Abs";a.rel="Rel";Object(C.a)(a,"PositionBaseType",null,[])},919:function(C,F,b){function a(S){this.calcManager=S}function e(){return w.call(this)||this}function d(){this.kpc=this.firstRow=null;return this}function l(){return w.call(this)||this}function n(){this.right=this.left=this.bottom=this.top=null;return this}function r(){return w.call(this)||
this}function h(){this.jpc=this.firstColumn=null;return this}function v(){var S=w.call(this)||this;S.Occ=!1;return S}function w(){this.end=this.start=0;this.zu=null}function t(){this.column=this.row=null;return this}function B(){}b.r(F);C=b(0);var z=b(15);Object(C.a)(B,"Reference",null,[]);Em(t,B);Object(C.a)(t,"CellReference",B,[]);w.prototype.Lxg=function(S,Q){for(var L=0;L<this.zu.length;L++){var aa=this.rWb(S,this.zu[L]);Q+=aa;L<this.zu.length-1&&(Q+=":")}return Q};Object(C.a)(w,"IReferenceSequence",
null,[]);var x=b(25),y=b(905);Em(v,w);v.prototype.l8b=function(){var S=b(919).RelativeAndAbsoluteReferencesManager,Q=this.zu[0];return S.zhf(Q.row.kind===y.a.abs,Q.column.kind===y.a.abs)};v.prototype.rWb=function(S,Q){Q=x.Range.ld(Q.row.index+1,Q.column.index+1);return this.Occ?Q.u7b(1===S||3===S,1===S||2===S):Q.f1a(1===S||3===S,1===S||2===S,!0,!0)};Object(C.a)(v,"CellReferenceSequence",w,[]);Em(h,B);Object(C.a)(h,"ColumnReference",B,[]);Em(r,w);r.prototype.l8b=function(){var S=this.zu[0];return b(919).RelativeAndAbsoluteReferencesManager.bgf(S.firstColumn,
S.jpc).kind===y.a.abs?2:3};r.prototype.rWb=function(S,Q){return x.Range.jrb(Q.firstColumn.index+1,Q.jpc.index+1).f1a(1===S||3===S,!0,1===S||3===S,!0)};Object(C.a)(r,"ColumnReferenceSequence",w,[]);Em(n,B);Object(C.a)(n,"RangeReference",B,[]);Em(l,w);l.prototype.l8b=function(){var S=b(919).RelativeAndAbsoluteReferencesManager,Q=this.zu[0];return S.zhf(Q.top.kind===y.a.abs,Q.left.kind===y.a.abs)};l.prototype.rWb=function(S,Q){Q=new x.Range(Q.top.index+1,Q.left.index+1,Q.bottom.index+1,Q.right.index+
1,!1,!1);var L=1===S||3===S;S=1===S||2===S;return Q.f1a(L,S,L,S)};Object(C.a)(l,"RangeReferenceSequence",w,[]);Em(d,B);Object(C.a)(d,"RowReference",B,[]);Em(e,w);e.prototype.l8b=function(){var S=this.zu[0];return b(919).RelativeAndAbsoluteReferencesManager.bgf(S.firstRow,S.kpc).kind===y.a.abs?0:1};e.prototype.rWb=function(S,Q){return x.Range.i6b(Q.firstRow.index+1,Q.kpc.index+1).f1a(!0,1===S||2===S,!0,1===S||2===S)};Object(C.a)(e,"RowReferenceSequence",w,[]);var J=b(1117),E=b(1118),A=b(7),H=b(187);
b.d(F,"RelativeAndAbsoluteReferencesManager",function(){return a});a.prototype.dZa=function(S,Q,L){var aa=Q;var fa=L;if(A.a.ma(S)||!H.e(S))return{returnValue:S,drd:aa,crd:fa};var W=this.calcManager.pJe(S);if(!W)return z.ULS.sendTraceTag(537169940,0,15,"RelativeAndAbsoluteReferencesManager.CycleThroughRelativeAndAbsoluteReferences: Couldn't extract references (might be invalid formula)"),{returnValue:null,drd:aa,crd:fa};W=this.JHh(W,S,Q,L);for(var G=0,N="",Y=0,V=0;V<W.length;V++)if(this.QAe(W[V],Q,
L)){G=W[V].l8b();aa=W[V].start;break}for(;V<W.length&&this.QAe(W[V],Q,L);V++)N+=S.substring(Y,W[V].start),N=W[V].Lxg(G,N),Y=W[V].end;Y&&(fa=N.length);N+=S.substring(Y,S.length);return{returnValue:N,drd:aa,crd:fa}};a.prototype.JHh=function(S,Q,L,aa){for(var fa=[],W=0;W<S.length;W++){var G=S[W];if(G.kind===J.a.range)if(G=G.ref,G.type===E.a.cell){var N=G;G=Object.assign(new v,{start:G.span.start,end:G.span.end,zu:[Object.assign(new t,{column:N.col,row:N.row})],Occ:this.calcManager.KYb(G.span.end,Q)});
fa.push(G)}else if(G.type===E.a.range)this.RAe(G.topLeftSpan,L,aa)&&this.RAe(G.bottomRightSpan,L,aa)?(N=new n,G.top.index<=G.bottom.index?(N.top=G.top,N.bottom=G.bottom):(N.bottom=G.top,N.top=G.bottom),G.left.index<=G.right.index?(N.left=G.left,N.right=G.right):(N.right=G.left,N.left=G.right),G=Object.assign(new l,{start:G.topLeftSpan.start,end:G.bottomRightSpan.end,zu:[N]}),fa.push(G)):(N=Object.assign(new v,{start:G.topLeftSpan.start,end:G.topLeftSpan.end,zu:[Object.assign(new t,{column:G.left,
row:G.top})],Occ:this.calcManager.KYb(G.topLeftSpan.end,Q)}),G=Object.assign(new v,{start:G.bottomRightSpan.start,end:G.bottomRightSpan.end,zu:[Object.assign(new t,{column:G.right,row:G.bottom})],Occ:this.calcManager.KYb(G.topLeftSpan.end,Q)}),fa.push(N),fa.push(G));else if(G.type===E.a.column){N=G;for(G=Object.assign(new r,{start:G.span.start,end:G.span.end,zu:[Object.assign(new h,{firstColumn:N.startIndex,jpc:N.endIndex})]});G.end<Q.length-1&&":"===Q.charAt(G.end)&&W<S.length-1;)if(N=S[W+1].ref,
N.type===E.a.column&&N.span.start===G.end+1){var Y=N;G.zu.push(Object.assign(new h,{firstColumn:Y.startIndex,jpc:Y.endIndex}));G.end=N.span.end;W++}else break;fa.push(G)}else if(G.type===E.a.row){N=G;for(G=Object.assign(new e,{start:G.span.start,end:G.span.end,zu:[Object.assign(new d,{firstRow:N.startIndex,kpc:N.endIndex})]});G.end<Q.length-1&&":"===Q.charAt(G.end)&&W<S.length-1;)if(N=S[W+1].ref,N.type===E.a.row&&N.span.start===G.end+1)Y=N,G.zu.push(Object.assign(new d,{firstRow:Y.startIndex,kpc:Y.endIndex})),
G.end=N.span.end,W++;else break;fa.push(G)}}return fa};a.prototype.QAe=function(S,Q,L){return!(S.start>L||Q>S.end)};a.prototype.RAe=function(S,Q,L){return!(S.start>L||Q>S.end)};a.bgf=function(S,Q){return S.index<=Q.index?S:Q};a.zhf=function(S,Q){return Q||S?Q&&S?2:!Q&&S?3:0:1};Object(C.a)(a,"RelativeAndAbsoluteReferencesManager",null,[428])}}]);

//# sourceMappingURL=EwaDS.calc.js.map