(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[17],{1040:function(C,F,b){b.d(F,"a",function(){return a});C=b(0);var a;(function(e){e[e.unknown=0]="unknown";e[e.supported=1]="supported";e[e.userUnsupported=2]="userUnsupported";e[e.browserUnsupported=3]="browserUnsupported";e[e.hostUnsupported=4]="hostUnsupported"})(a||(a={}));Object(C.b)("SupportStatus",a)},1383:function(C,F,b){function a(fa){var W=aa.call(this)||this;W.$=fa;W.Yb();return W}function e(fa){this.oAuthManager=
fa}function d(){}function l(fa){this.zQb=fa}function n(){}function r(){}b.r(F);C=b(0);var h=b(15),v=b(969),w=b(1040),t=b(5),B=b(93),z=b(839),x=b(276),y=b(48),J=b(23),E=b(88),A=b(177);r.prototype.Qh=function(fa){fa.register(219,"Common.App.OAuth.IOAuthManager").wc().Fc(function(){return new v.OAuthManager})};r.prototype.init=function(){var fa=E.a.instance.resolve("Common.App.OAuth.IOAuthManager");this.Ptj(fa)};r.prototype.Ptj=function(fa){var W=t.AFrameworkApplication.ha.Ta("FileSource");if(t.AFrameworkApplication.ha.sa("IsO365ConsumerHost")||
t.AFrameworkApplication.ha.sa("IsO365CommercialHost")||"WopiTest"===W){var G=z.a.gqh,N=z.a.authority;if(void 0!==G&&null!==G&&G.length&&void 0!==N&&null!==N&&N.length&&("https://login.microsoftonline.com/"!==N||t.AFrameworkApplication.ha.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CorePFTEnabled",!1))){var Y=w.a[fa.mR],V=J.a.iXa,da=fa.OD();t.AFrameworkApplication.ha.sa("IsAnonymousUser")&&h.ULS.sendTraceTag(559272964,3E3,50,'OAuthManager skipped attempt to get a Core token to the WAC FrontEnd API for an anonymous user. SupportStatus={0}, Host="{1}", Browser="{2}", Strategy="{3}"',
Y,W,V,da);try{var U=new Map;void 0!==U&&null!==U?(U.set("SupportStatus",Y),U.set("Browser",V),U.set("AuthStrategy",da)):U=null}catch(ca){U=null}B.Health.instance.recordKpiUsageForAlertableKpi("WacCorePFT","WacOAuthFC",U);var Z=y.a.Pe();fa.aR("Core",G).then(function(ca){var ra=Math.floor(y.a.Pe()-Z);Y=w.a[fa.mR];h.ULS.sendTraceTag(562943369,3E3,50,'OAuthManager attempted to get a Core token to the WAC FrontEnd API in {0} ms. Success={1}, SupportStatus={2}, ErrorCode="{3}", Host="{4}", Browser="{5}", AuthStrategy="{6}"',
ra,ca.IsSuccess,Y,ca.ErrorCode,W,V,da);ra=Object.assign(new A.a,{durationMs:ra,extendedProperties:U});ca.IsSuccess?B.Health.instance.recordKpiSuccess("WacCorePFT",ra):B.Health.instance.recordKpiFailure("WacCorePFT",ca.ErrorCode,!1,!1,ra)})}}};r.prototype.dispose=function(){};r.main=function(){x.a.instance.ej(new r)};Ll.Object.defineProperties(r.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"Common.App.OAuth.OAuthPackage"}}});Object(C.a)(r,"OAuthPackage",null,[8,9]);var H=b(1067);
Object(C.a)(n,"LokiTokenResult",null,[]);l.prototype.p$c=function(){var fa=this,W=this.PCh();return W?l.Mid?new Promise(function(G,N){fa.zQb.continueWith(function(){fa.zQb.wh||fa.zQb.gg?N(Error.create("Error downloading auth library")):fa.zQb.result.aR("Loki",W).then(function(Y){Y=t.AFrameworkApplication.ha.sa("ForceLokiFallbackToACLPTokenIsEnabled")?fa.SCh():Y.IsSuccess&&Y.Token?Object.assign(new n,{isSuccess:!0,token:Y.Token,errorMessage:null}):Object.assign(new n,{isSuccess:!1,token:null,errorMessage:JSON.stringify(Y)});
G(Y);return Y})})}):Promise.resolve(Object.assign(new n,{isSuccess:!1,token:null,errorMessage:"Not attempting to fetch token because host is not an O365 host."})):Promise.resolve(Object.assign(new n,{isSuccess:!1,token:null,errorMessage:String.format("Could not get Loki App Id for HostAuthorityType: [{0}]",H.a.iOe())}))};l.prototype.SCh=function(){var fa=t.AFrameworkApplication.ha.Ta("LokiUserDataSignature")||"";return Object.assign(new n,{isSuccess:!0,token:fa,errorMessage:null})};l.prototype.PCh=
function(){var fa=null,W=H.a.G6b();2===W?fa=t.AFrameworkApplication.ha.Ta("LokiAADAppId"):1===W&&(fa=t.AFrameworkApplication.ha.Ta("LokiMSAAppId"));return fa};Ll.Object.defineProperties(l,{Mid:{configurable:!0,enumerable:!0,get:function(){return t.AFrameworkApplication.ha.sa("IsO365CommercialHost")||t.AFrameworkApplication.ha.sa("IsO365ConsumerHost")}}});Object(C.a)(l,"LokiTokenManager",null,[251]);var S=b(520);d.prototype.init=function(){E.a.instance.resolve("Common.ILokiTokenManager")};d.prototype.dispose=
function(){};d.prototype.Qh=function(fa){fa.register(l,"Common.App.LivePersonaUtils.LokiTokenManager").as("Common.ILokiTokenManager").wc().Fc(function(){return new l(S.a.mq(fa.oc("Common.App.OAuth.IOAuthManager")))})};d.main=function(){x.a.instance.ej(new d)};Ll.Object.defineProperties(d.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"Common.App.LivePersonaUtils"}}});Object(C.a)(d,"LivePersonaUtilsPackage",null,[8,9]);var Q=b(12);F=b(212);var L=b(930);e.prototype.aR=function(fa,
W){return this.oAuthManager?this.oAuthManager.aR(fa,W).then(function(G){G.IsSuccess||h.ULS.sendTraceTag(51401292,0,15,"Error retrieving auth token. Message: "+G.ErrorMessage+" Error code: "+G.ErrorCode+" App name: "+fa);return Object.assign(new L.a,{IsSuccess:G.IsSuccess,Token:G.Token,ErrorCode:G.ErrorCode,ErrorMessage:G.ErrorMessage})}):(h.ULS.sendTraceTag(537154971,0,10,"Oauth manager is null"),Promise.resolve(Object.assign(new L.a,{IsSuccess:!1,Token:null,ErrorCode:"FailedToResolve",ErrorMessage:"Failed to resolve IOAuthManager from the container."})))};
e.prototype.NJa=function(){return this.oAuthManager?this.oAuthManager.NJa():null};Object(C.a)(e,"OAuthManagerWrapper",null,[249]);var aa=F.a;Em(a,aa);a.prototype.create=function(){this.Eb(this.$.ea.Ba(349)||new e(E.a.instance.resolve("Common.App.OAuth.IOAuthManager")))};a.ja=function(fa){fa.ea.Ia(350,new a(fa))};Object(C.a)(a,"OAuthManagerFactory",F.a,[]);Type.registerNamespace("_Ewa");Type.registerNamespace("Common.App.AppsForOfficeCommon");Type.registerNamespace("Common.App.OAuth");r.main();Type.registerNamespace("Common.App.LivePersonaUtils");
d.main();(function(){Q.a.Ga(function(fa){a.ja(fa)})})()},969:function(C,F,b){function a(ma){var xa=this;this.mR=0;this.ON=null;this.uig=0;this.$dg=this.R1g(void 0===ma?null:ma).then(function(Pa){return Pa?xa.bUh():Promise.resolve(1)}).then(function(Pa){return Pa?Promise.resolve(Pa):xa.Nai()})}function e(ma){this.Xhb=ma;this.VUa="UnsupportedAuthTokenStrategy Reason="+J.a[this.Xhb]}function d(){this.Qs=null;this.ROb=0;this.Mgb=this.gVa=this.vzc=this.SBa=this.TK=this.Mae=null;this.Tu=new U.a(null,null);
this.$Mc=H.AFrameworkApplication.ha.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SharedAuthVNext",!1);this.VUa="SharedAuthTokenStrategy "+(this.$Mc?"BrowserAuth 1.20210701.2/MSAL 2.11.0":"BrowserAuth 1.20210426.1/MSAL 2.11.0");this.dX=S.a.Nbj;this.Q9d=S.a.Mbj;this.fZd=S.a.enableConsoleLogging;this.Nbg=H.AFrameworkApplication.ha.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthPopupFlashEnabled",!1);this.ckg=H.AFrameworkApplication.ha.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthSkipUpnCheckEnabled",
this.$Mc);this.bpa={};this.keg=new r(1500)}function l(ma,xa,Pa,ib,pb,xb){var Ya=da.call(this,!1,!1,!0)||this;Ya.o0=null;Ya.uYd=null;Ya.dX=ma;Ya.Ohg=Pa;Ya.Tu=ib;Ya.Flg=pb;Ya.SBa=xb;Ya.Qs=document.createElement("iframe");Ya.Qs.id="SharedAuthInteractiveFrame";Ya.Qs.setAttribute("name","SharedAuthInteractiveFrame");Ya.Qs.setAttribute("title","SharedAuthInteractiveFrame");Ya.Qs.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups");Ya.Qs.style.border="0";Ya.Qs.style.height=
"48px";$addHandler(Ya.Qs,"error",Object(aa.a)(Ya,Ya.vzi,"onSharedAuthFrameError"));ma=String.format("{0}{1}{2}{3}{4}{5}{6}{7}{8}",Ya.dX,xa,"?replyUrl=",window.location.protocol,"//",window.location.host,"&interactive=1","&WacUserType=",H.AFrameworkApplication.userType);H.AFrameworkApplication.ha.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SharedAuthVNext",!1)&&(ma+="&vnext=1");Ya.Qs.src=ma;Ya.tbg=new Promise(function(ab){Ya.uYd=ab});Ya.vYd=!1;return Ya}function n(){this.correlationId=this.resolve=
null}function r(ma){ma=void 0===ma?0:ma;this.RA=0;this.Ehb=!1;this.km=new W.a;this._timeout=ma}function h(){this.reject=this.resolve=null;this.startTime=0;this.mzf=this.kle=null}function v(){this.Lbe=null;var ma=H.AFrameworkApplication.ha.Ta(H.AFrameworkApplication.Bza),xa=H.AFrameworkApplication.ha.Ta(H.AFrameworkApplication.x0f);this.VUa=String.format("ParentFrameTokenStrategy uiHost={0} uiHostIntegrationType={1}",ma&&""!==ma?ma:"Unspecified",xa&&""!==xa?xa:"Unspecified")}function w(ma,xa,Pa,ib,
pb){this.scope=this.resource=null;this.silentLogin=!1;this.correlationId=this.options=null;this.resource=ma;this.scope=xa;this.silentLogin=Pa;this.options=ib;this.correlationId=pb}function t(){}function B(ma){this.fgg=ma}function z(){}b.r(F);C=b(0);var x=b(15),y=b(799),J=b(1040),E;(function(ma){ma[ma.external=0]="external";ma[ma.msa=1]="msa";ma[ma.aad=2]="aad"})(E||(E={}));Object(C.b)("AuthorityType",E);Object(C.a)(z,"OAuthResult",null,[]);B.prototype.initialize=function(){return Promise.resolve(0)};
B.prototype.Nec=function(){return Promise.resolve(0)};B.prototype.aR=function(){x.ULS.sendTraceTag(574239257,3E3,50,"Automation flag set.  Returning Mock Token.");return Promise.resolve(Object.assign(new z,{IsSuccess:!0,Token:this.fgg}))};B.prototype.cvc=function(){return Promise.resolve(Object.assign(new z,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))};B.prototype.Itc=function(){return!1};
B.prototype.Psb=function(){return"MockAuthTokenStrategy"};Object(C.a)(B,"MockAuthTokenStrategy",null,[274]);var A=b(1067);t.get=function(ma,xa,Pa){if(!Pa)return ma;var ib=0;return Promise.race([ma,new Promise(function(pb){ib=window.setTimeout(function(){pb(xa)},Pa)})]).then(function(pb){window.clearTimeout(ib);return Promise.resolve(pb)}).catch(function(){window.clearTimeout(ib);return Promise.resolve(xa)})};Object(C.a)(t,"PromiseWithTimeout",null,[]);var H=b(5),S=b(839);Object(C.a)(w,"TokenRequestParameters",
null,[331]);var Q=b(23),L=b(88);v.prototype.initialize=function(){var ma=this;return new Promise(function(xa){L.a.instance.oc("Common.App.WopiIdentity.IWopiIdentity").execute(function(Pa){ma.Lbe=Pa;xa(0)})})};v.prototype.Th=function(ma){for(var xa=!1,Pa=ma.toLocaleUpperCase(),ib=Ol(["HTTPS:","API:"]),pb=ib.next();!pb.done;pb=ib.next())if(Pa.startsWith(pb.value)){xa=!0;break}return xa||this.x2h(ma)?ma+"/.default":ma};v.prototype.x2h=function(ma){return RegExp("/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i").test(ma)};
v.prototype.Nec=function(){return Promise.resolve(0)};v.prototype.aR=function(ma,xa,Pa,ib,pb,xb,Ya){if(Q.a.nja&&(pb=!1,H.AFrameworkApplication.ha.getBooleanFeatureGate("Microsoft.Office.SharedOnline.HostSupportsTeamsElectronSSO",!1)&&(xb=S.a.oCj)&&(pb=Array.contains(xb,ma)),!pb))return xa=Object.assign(new z,{IsSuccess:!1,ErrorCode:"TeamsDisallowedApp",ErrorMessage:"Disallowed appName: "+ma}),Promise.resolve(xa);ma=this.Th(Pa);Pa=new w(Pa,ma,!ib,null,H.AFrameworkApplication.userSessionId);return this.Lbe.getAccessToken(Pa,
xa,Ya).then(function(ab){return Object.assign(new z,{IsSuccess:!0,Token:ab.accessToken})},function(ab){return Object.assign(new z,{IsSuccess:!1,ErrorCode:ab})})};v.prototype.cvc=function(){return Promise.resolve(Object.assign(new z,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))};v.prototype.Itc=function(){return!1};v.prototype.Psb=function(){return this.VUa};Object(C.a)(v,"ParentFrameTokenStrategy",
null,[274]);var aa=b(37),fa=b(975),W=b(211);Object(C.a)(h,"PromiseWrapper",null,[]);r.prototype.enqueue=function(ma){var xa=this;return new Promise(function(Pa,ib){xa.km.add(Object.assign(new h,{mzf:ma,resolve:Pa,reject:ib}));xa.process()})};r.prototype.process=function(){var ma=this;if(this.Ehb||this.RA===this.km.count)return!1;var xa=this.km.oa(this.RA++);try{this.Ehb=!0,xa.mzf().then(function(Pa){ma.Ehb=!1;ma.qXc(xa,Pa,null,!0)}).catch(function(Pa){ma.Ehb=!1;ma.qXc(xa,null,Pa,!1)})}catch(Pa){this.Ehb=
!1,this.qXc(xa,null,Pa,!1)}return!0};r.prototype.qXc=function(ma,xa,Pa,ib){var pb=this;ib?0<this._timeout?window.setTimeout(function(){ma.resolve(xa);pb.process()},this._timeout):(ma.resolve(xa),pb.process()):0<this._timeout?window.setTimeout(function(){ma.reject(Pa);pb.process()},this._timeout):(ma.reject(Pa),pb.process())};Object(C.a)(r,"PromiseQueue",null,[]);Object(C.a)(n,"ResolveWithCorrelation",null,[]);var G=b(83),N=b(140),Y=b(945),V=b(178),da=N.a;Em(l,da);l.prototype.asc=function(){var ma=
{};ma=(ma.promptMessage=this.Ohg,ma.errorText=CommonUIStrings.l_InternalError,ma.rtl=H.AFrameworkApplication.isRtl,ma.frameLoaded=!1,ma.createFrame=Object(aa.a)(this,this.lUg,"createFrame"),ma.resolveDialogStyles=this.uYd,ma);var xa={};this.o0=(xa.id="SharedAuthConsentDialog",xa.bodyControls=ma,xa);this.hc=5;this.initializeAndShow(CommonUIStrings.l_SignIn,Object(aa.a)(this,this.Lbj,"sharedAuthConsentDialogHandler"),this.o0)};l.prototype.d3f=function(ma,xa){var Pa=!0;Pa=void 0===Pa?!1:Pa;ma=void 0===
ma?!1:ma;xa=void 0===xa?5:xa;this.o0&&this.o0.bodyControls&&(Pa!==Object(G.a)(Object,this.o0.bodyControls).frameLoaded&&(Object(G.a)(Object,this.o0.bodyControls).frameLoaded=Pa),ma!==Object(G.a)(Object,this.o0.bodyControls).frameLoadSuccess&&(Object(G.a)(Object,this.o0.bodyControls).frameLoadSuccess=ma),xa!==this.o0.dialogButtonsOption&&(this.o0.dialogButtonsOption=null,this.hc=xa),this.update(this.o0))};l.prototype.Zhj=function(ma,xa){var Pa=new Y.a(V.a.Pbj),ib={};ma=(ib.signInLabel=CommonUIStrings.l_SignIn,
ib.cancelLabel=CommonUIStrings.l_DialogCancel,ib.rtl=H.AFrameworkApplication.isRtl,ib.messageCorrelationId=ma,ib.dialogStyles=xa,ib);Pa.Values=ma;this.Tu.OOa(Pa,this.Qs.contentWindow,this.dX)};l.prototype.eMe=function(){this.d3f(!1,6)};l.prototype.vzi=function(){this.eMe()};l.prototype.lUg=function(){return this.Qs};l.prototype.Lbj=function(ma){ma||(this.Flg.reject(Object.assign(new z,{ErrorCode:"UserCancelled",ErrorMessage:"The interactive flow was cancelled by the user"})),this.SBa(null))};Ll.Object.defineProperties(l.prototype,
{HQf:{configurable:!0,enumerable:!0,get:function(){return this.Qs}},E2g:{configurable:!0,enumerable:!0,get:function(){var ma=this;return this.tbg.then(function(xa){ma.vYd=!0;return xa})}},F2g:{configurable:!0,enumerable:!0,get:function(){return this.vYd}}});Object(C.a)(l,"SharedAuthConsentDialog",N.a,[284]);var U=b(1235),Z=b(93),ca=b(48),ra=b(196),La=b(177);d.prototype.Psb=function(){return this.VUa};d.prototype.initialize=function(){var ma=b(969).OAuthManager;if("loadFrame"in this.bpa)return this.bpa.loadFrame.kle;
if(!this.dX)return Z.Health.instance.recordKpiFailure(ma.kpiName,"SharedFrameOriginNotSet",!1,!1,null),x.ULS.sendTraceTag(562381581,3E3,10,"SharedAuthTokenStrategy Init failed: No Shared Frame Origin Path"),Promise.reject(1);ma=this.qtc("loadFrame");this.ROb=ca.a.Pe();var xa=this.dX+this.Q9d+"?replyUrl="+window.location.protocol+"//"+window.location.host+"&usid="+H.AFrameworkApplication.userSessionId+"&WacUserType="+H.AFrameworkApplication.userType;this.$Mc&&(xa+="&vnext=1");this.Qs=document.createElement("iframe");
this.DVh(this.Qs);this.Qs.style.cssText="height:0;width:0;display:none;";this.Qs.id="SharedAuthFrame";this.Qs.setAttribute("name","SharedAuthFrame");this.Qs.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups");this.Qs.setAttribute("title","SharedAuthFrame");this.Qs.src=xa;document.body.appendChild(this.Qs);xa=ca.a.Pe()-this.ROb;x.ULS.sendTraceTag(573112899,3E3,50,"SharedAuthTokenStrategy Create: Frame Appended to Document. E/T:[{0}]. sharedAuthFrame.Src={1}",xa,this.Qs.src);
return ma};d.prototype.Nec=function(ma){this.vzc=ma;var xa=new Y.a(V.a.KQf);xa.Values=this.Mke(ma);ma=this.qtc("initFrame");this.Tu.OOa(xa,this.Qs.contentWindow,this.dX);x.ULS.sendTraceTag(573112900,3E3,50,"SharedAuthTokenStrategy Init: Called package initialize.");return ma};d.prototype.aR=function(ma,xa,Pa,ib,pb,xb){var Ya=this,ab=new Y.a(V.a.Qbj),ea=this.VTe();ab.Values=this.U_f(ma,xa,Pa,ib,pb,xb,ea);ma=this.qtc(ea);ib&&H.AFrameworkApplication.ha.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SharedAuthInteractiveConsentUI",
!1)?this.keg.enqueue(function(){return new Promise(function(ta){Ya.ftj(xb,ab,ta,ea)})}):(this.Tu.OOa(ab,this.Qs.contentWindow,this.dX),x.ULS.sendTraceTag(573112901,3E3,50,"SharedAuthTokenStrategy TryGetToken: Called TryGetToken for app {0}",xa));return ma};d.prototype.ftj=function(ma,xa,Pa,ib){var pb=this.bpa[ib];pb&&(this.gVa=xa,this.SBa=Object.assign(new n,{resolve:Pa,correlationId:ib}),this.TK=new l(this.dX,this.Q9d,ma,this.Tu,pb,Pa),this.TK.asc())};d.prototype.VTe=function(){return ra.a.create().toString()};
d.prototype.U_f=function(ma,xa,Pa,ib,pb,xb,Ya){var ab={};ab.appName=ma;ab.appId=xa;ab.target=Pa;ab.withPopup=ib;ab.claims=pb;ab.promptMessage=xb;ab.messageCorrelationId=Ya;return ab};d.prototype.DVh=function(ma){$addHandler(ma,"load",Object(aa.a)(this,this.Aui,"onIFrameLoaded"));$addHandler(ma,"error",Object(aa.a)(this,this.nic,"onIFrameError"));this.Tu.CDa(this.dX);this.Tu.En(V.a.NQf);this.Tu.xm(V.a.NQf,Object(aa.a)(this,this.Ryi,"onScriptLoaded"));this.Tu.En(V.a.MQf);this.Tu.xm(V.a.MQf,Object(aa.a)(this,
this.Qyi,"onScriptInitialized"));this.Tu.En(V.a.IQf);this.Tu.xm(V.a.IQf,Object(aa.a)(this,this.dui,"onGetTokenResponse"));this.Tu.En(V.a.OQf);this.Tu.xm(V.a.OQf,Object(aa.a)(this,this.Qvi,"onLoginResponse"));this.Tu.En(V.a.LQf);this.Tu.xm(V.a.LQf,Object(aa.a)(this,this.Uui,"onInteractiveFlowReady"));this.Tu.En(V.a.JQf);this.Tu.xm(V.a.JQf,Object(aa.a)(this,this.tui,"onHideDialog"));this.Tu.En(V.a.GQf);this.Tu.xm(V.a.GQf,Object(aa.a)(this,this.Mpi,"onCloseDialog"))};d.prototype.qtc=function(ma){var xa=
new h;xa.startTime=ca.a.Pe();var Pa=new Promise(function(ib,pb){xa.resolve=ib;xa.reject=pb});xa.kle=Pa;this.bpa[ma]=xa;return Pa};d.prototype.Aui=function(){var ma=ca.a.Pe()-this.ROb;x.ULS.sendTraceTag(572346566,3E3,50,"WACOAuth.aspx iFrame loaded successfully. E/T:[{0}]",ma)};d.prototype.nic=function(ma){var xa=b(969).OAuthManager,Pa=ca.a.Pe()-this.ROb,ib=Object.assign(new La.a,{durationMs:Pa});Z.Health.instance.recordKpiFailure(xa.kpiName,"WACOAuthAspxFrameError",!1,!0,ib);x.ULS.sendTraceTag(572346567,
3E3,10,"WACOAuth.aspx iFrame failed to load after {0} ms: {1}",Pa,this.fZd?JSON.stringify(ma):"")};d.prototype.Ryi=function(ma){var xa=b(969).OAuthManager,Pa=this.bpa.loadFrame,ib=ca.a.Pe()-Pa.startTime,pb=ma.Values.AuthLibrary.toString();ma=ma.Values.Success.toString();x.ULS.sendTraceTag(573112902,3E3,50,"SharedAuthTokenStrategy OnScriptLoaded. Success={0} AuthLibrary={1} E/T: [{2}]",ma,pb,ib);pb&&(this.VUa="SharedAuthTokenStrategy "+pb);pb=Boolean.parse(ma);pb||(ma=this.fs(),void 0!==ma&&null!==
ma&&(ma.set("AuthLibrary",this.Psb()),ib=Object.assign(new La.a,{durationMs:ib,extendedProperties:ma}),Z.Health.instance.recordKpiFailure(xa.kpiName,"StrategyInitFailed",!1,!0,ib)));Pa.resolve(pb?0:1)};d.prototype.Qyi=function(ma){var xa=this;if(ma.Values.interactive&&this.gVa&&this.gVa.Values.messageCorrelationId){var Pa=this.gVa.Values.messageCorrelationId.toString();if(ma.Values.interactive&&this.TK){this.TK.E2g.then(function(pb){xa.Tu.OOa(xa.gVa,xa.TK.HQf.contentWindow,xa.dX);xa.TK.Zhj(Pa,pb);
xa.TK.d3f(!0);xa.gVa=null});return}}ma=this.bpa.initFrame;var ib=ca.a.Pe()-ma.startTime;x.ULS.sendTraceTag(573112903,3E3,50,"SharedAuthTokenStrategy OnScriptInitialized. E/T: [{0}]",ib);ma.resolve(0)};d.prototype.dui=function(ma){if(ma.Values.messageCorrelationId&&ma.Values.messageCorrelationId.toString()){var xa=ma.Values.messageCorrelationId.toString(),Pa=this.bpa[xa];if(Pa){var ib=ca.a.Pe()-Pa.startTime;x.ULS.sendTraceTag(573112906,3E3,50,"SharedAuthTokenStrategy OnGetTokenResponse. E/T: [{0}]",
ib);ma.Values.isSuccess&&ma.Values.isSuccess?Pa.resolve(ma.Values.response):Pa.reject(ma.Values.response);this.i0f(xa)}else x.ULS.sendTraceTag(573112905,3E3,10,"SharedAuthTokenStrategy OnGetTokenResponse called with an unregistered messageCorrelationId")}else x.ULS.sendTraceTag(573112904,3E3,10,"SharedAuthTokenStrategy OnGetTokenResponse called without valid messageCorrelationId")};d.prototype.Uui=function(){if(this.TK.F2g)this.TK.eMe();else if(this.vzc&&this.TK){var ma=new Y.a(V.a.KQf);ma.Values=
this.Mke(this.vzc,!0);this.Tu.OOa(ma,this.TK.HQf.contentWindow,this.dX)}};d.prototype.tui=function(){this.TK&&this.TK.Ztb()};d.prototype.Mpi=function(ma){ma.Values.cancelled&&ma.Values.cancelled&&ma.Values.messageCorrelationId&&this.i0f(ma.Values.messageCorrelationId.toString());this.TK&&this.TK.hide()};d.prototype.fs=function(){try{return new Map}catch(ma){return null}};d.prototype.Mke=function(ma,xa){xa=void 0===xa?!1:xa;H.AFrameworkApplication.ha.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SharedAuthVNext",
!1);var Pa={};Pa.appIds=this.Uth();Pa.upn=ma.loginHint;Pa.authority=ma.authority;Pa.authorityType=Object(y.a)(E,ma.authorityType);Pa.tenantId=ma.tenantId;Pa.correlationId=H.AFrameworkApplication.userSessionId;Pa.enableConsoleLogging=this.fZd;Pa.enablePopupFlash=this.Nbg;Pa.skipUpnCheck=this.ckg;Pa.interactive=xa;return Pa};d.prototype.Uth=function(){var ma=[],xa=S.a.OQc,Pa;for(Pa in xa)Array.add(ma,xa[Pa]);return ma};d.prototype.cvc=function(ma,xa,Pa,ib,pb,xb){var Ya=new Y.a(V.a.Obj),ab=this.VTe();
Ya.Values=this.U_f(ma,xa,Pa,ib,pb,xb,ab);this.Mae=Ya;ma=this.qtc(ab);x.ULS.sendTraceTag(555049437,3E3,50,"SharedAuthTokenStrategy TryLogin: Called TryLogin for app {0}",xa);this.Afj();return ma};d.prototype.Itc=function(){return!0};d.prototype.Afj=function(){var ma=this;this.Mgb||(this.Mgb=new fa.a(CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Title,CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Body,null),this.Mgb.id=16,this.Mgb.B6e=!1,this.Mgb.addButton(CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Button,
function(){ma.Tu.OOa(ma.Mae,ma.Qs.contentWindow,ma.dX)},CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Button,!0),x.ULS.sendTraceTag(555049438,3E3,10,"Failed to add entry to business bar. Login message could not be shown to user."))};d.prototype.Qvi=function(ma){if(ma.Values.messageCorrelationId&&ma.Values.messageCorrelationId.toString()){var xa=this.bpa[ma.Values.messageCorrelationId.toString()];if(xa){var Pa=ca.a.Pe()-xa.startTime;x.ULS.sendTraceTag(555049441,3E3,50,"SharedAuthTokenStrategy OnLoginResponse. E/T: [{0}]",
Pa);ma.Values.isSuccess&&ma.Values.isSuccess?xa.resolve(ma.Values.response):xa.reject(ma.Values.response)}else x.ULS.sendTraceTag(555049440,3E3,10,"SharedAuthTokenStrategy OnLoginResponse called with an unregistered messageCorrelationId")}else x.ULS.sendTraceTag(555049439,3E3,10,"SharedAuthTokenStrategy OnLoginResponse called without valid messageCorrelationId")};d.prototype.i0f=function(ma){this.SBa&&this.SBa.correlationId===ma&&(this.SBa.resolve(null),this.SBa=null)};Object(C.a)(d,"SharedAuthTokenStrategy",
null,[274]);e.prototype.initialize=function(){return Promise.resolve(0)};e.prototype.Nec=function(){return Promise.resolve(0)};e.prototype.aR=function(){return Promise.resolve(Object.assign(new z,{IsSuccess:!1,ErrorCode:J.a[this.Xhb],ErrorMessage:"Unable to get a token. Reason: ["+J.a[this.Xhb]+"]"}))};e.prototype.cvc=function(){return Promise.resolve(Object.assign(new z,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))};
e.prototype.Itc=function(){return!1};e.prototype.Psb=function(){return this.VUa};Object(C.a)(e,"UnsupportedAuthTokenStrategy",null,[274]);var na=b(829);b.d(F,"OAuthManager",function(){return a});a.prototype.S1g=function(){var ma=S.a.Iii;ma&&0<ma.length?(this.mR=1,this.ON=new B(ma)):H.AFrameworkApplication.ha.sa("IsO365ConsumerHost")||H.AFrameworkApplication.ha.sa("IsO365CommercialHost")?(ma=A.a.getAuthContext().loginHint)&&ma.length&&!H.AFrameworkApplication.ha.sa("IsAnonymousUser")?S.a.aub?(this.mR=
1,this.ON=new v):a.b4h()?(this.mR=1,this.ON=new d):(this.mR=3,this.ON=new e(this.mR)):(this.mR=2,this.ON=new e(this.mR)):(this.mR=4,this.ON=new e(this.mR))};a.prototype.OD=function(){return this.ON?this.ON.Psb()||"Unknown":"None"};a.prototype.R1g=function(ma){var xa=this;ma=void 0===ma?null:ma;x.ULS.sendTraceTag(562128578,3E3,50,"Creating OAuthManager.");var Pa=ca.a.Pe();return H.AFrameworkApplication.ha.J9c().then(function(ib){ib?(xa.S1g(),ma&&(xa.ON=ma),x.ULS.sendTraceTag(42084323,3E3,50,"Creation succeeded OAuthManager successfully in {4} ms with clientVer={0}, appVer={1}, docVer={2}, strategy={3}",
S.a.clientVersion,S.a.appVersion,S.a.S4g,xa.OD(),Math.floor(ca.a.Pe()-Pa))):x.ULS.sendTraceTag(562128579,3E3,15,"Creation failed for OAuthManager, unable to get app settings after {0} ms, all future TryGetToken requests will fail.",Math.floor(ca.a.Pe()-Pa));return Promise.resolve(ib)},function(){x.ULS.sendTraceTag(562128580,3E3,15,"Creation failed for OAuthManager, unable to get app settings after {0} ms, all future TryGetToken requests will fail.",Math.floor(ca.a.Pe()-Pa));return Promise.resolve(!1)})};
a.prototype.bUh=function(){var ma=this;x.ULS.sendTraceTag(573390991,3E3,50,"Initializing {0}",this.OD());var xa=ca.a.Pe();return t.get(this.ON.initialize(),2,S.a.Dyd).then(function(Pa){if(Pa)if(1===Pa){var ib=ma.fs();void 0!==ib&&null!==ib&&(ib.set("AuthLibrary",ma.OD()),ib=Object.assign(new La.a,{durationMs:Math.floor(ca.a.Pe()-xa),extendedProperties:ib}),Z.Health.instance.recordKpiFailure(a.kpiName,"StrategyInitFailed",!1,!0,ib))}else 2===Pa&&(x.ULS.sendTraceTag(42267908,3E3,15,"Initialization timed out for {0} after {1} ms, all future TryGetToken requests will fail.",
ma.OD(),Math.floor(ca.a.Pe()-xa)),ib=ma.fs(),void 0!==ib&&null!==ib&&(ib.set("AuthLibrary",ma.OD()),ib=Object.assign(new La.a,{durationMs:Math.floor(ca.a.Pe()-xa),extendedProperties:ib}),Z.Health.instance.recordKpiFailure(a.kpiName,"StrategyInitTimedOut",!1,!0,ib)));else x.ULS.sendTraceTag(42084353,3E3,50,"Initialization succeeded for {0} in {1} ms.",ma.OD(),Math.floor(ca.a.Pe()-xa));return Promise.resolve(Pa)},function(){x.ULS.sendTraceTag(574239256,3E3,15,"Initialization failed for {0} after {1} ms, all future TryGetToken requests will fail.",
ma.OD(),Math.floor(ca.a.Pe()-xa));return Promise.resolve(1)})};a.prototype.Nai=function(){var ma=this;x.ULS.sendTraceTag(562128581,3E3,50,"Loading {0}",this.OD());var xa=ca.a.Pe();return t.get(this.ON.Nec(A.a.getAuthContext()),2,S.a.Dyd).then(function(Pa){Pa?1===Pa?x.ULS.sendTraceTag(562128583,3E3,15,"Load failed for {0} after {1} ms, all future TryGetToken requests will fail.",ma.OD(),Math.floor(ca.a.Pe()-xa)):2===Pa&&x.ULS.sendTraceTag(558469660,3E3,15,"Load timed out for {0} after {1} ms, all future TryGetToken requests will fail.",
ma.OD(),Math.floor(ca.a.Pe()-xa)):x.ULS.sendTraceTag(562128582,3E3,50,"Load succeeded for {0} in {1} ms.",ma.OD(),Math.floor(ca.a.Pe()-xa));return Promise.resolve(Pa)},function(){x.ULS.sendTraceTag(562128584,3E3,15,"Load failed for {0} after {1} ms, all future TryGetToken requests will fail.",ma.OD(),Math.floor(ca.a.Pe()-xa));return Promise.resolve(1)})};a.prototype.aR=function(ma,xa,Pa){return this.avc(ma,xa,!1,null,"",void 0===Pa?null:Pa)};a.prototype.V_f=function(ma,xa,Pa,ib,pb){return this.avc(ma,
xa,!0,Pa,ib,void 0===pb?null:pb)};a.prototype.avc=function(ma,xa,Pa,ib,pb,xb,Ya){Ya=void 0===Ya?0:Ya;Ya+=1;x.ULS.sendTraceTag(42084352,3E3,50,"OAuthManager TryGetToken(appName={0}, target={1}) called.  Using strategy {2} - attempt {3}",ma,this.zOa(ma,xa),this.OD(),Ya);var ab=this.fs();void 0!==ab&&null!==ab&&(ab.set("AuthLibrary",this.OD()),ab.set("AppName",ma),ab.set("Target",this.zOa(ma,xa)),Z.Health.instance.recordKpiUsage(a.kpiName,0,"WacOAuthFC",ab));if(!S.a.isEnabled){var ea;return this.wnd((ea=
new z,ea.IsSuccess=!1,ea.Token=null,ea.ErrorCode="NotEnabled",ea.ErrorMessage="OAuthManager is disabled.",ea),ma)}var ta=S.a.OQc[ma];if(void 0===ta||null===ta){x.ULS.sendTraceTag(41961345,3E3,15,"Auth context not found. Ensure that your app [{0}] is listed in the OAuthManagerApplications setting.",ma);var Ka;return this.wnd((Ka=new z,Ka.IsSuccess=!1,Ka.Token=null,Ka.ErrorCode="DisallowedApp",Ka.ErrorMessage="Disallowed appName: "+ma,Ka),ma)}var mb=ca.a.Pe(),Ha=this;ab=this.$dg.then(function(db){return Ha.yZh(ma,
ta,xa,Pa,ib,pb,xb,db)});ea=Pa?0:S.a.Dyd;var Ga;Ka=(Ga=new z,Ga.IsSuccess=!1,Ga.Token=null,Ga.ErrorCode="authTokenStrategy_timeout",Ga.ErrorMessage="Auth Strategy timed out after ["+ea+"] ms when fetching token",Ga);var Fa=this,eb=this;return t.get(ab,Ka,ea).then(function(db){return Ya<=a.chi&&(db.ErrorCode===a.cZf||db.ErrorCode===a.vmj)?(x.ULS.sendTraceTag(573175516,3E3,50,"TryGetToken attempt {0} timed out after {1} ms - retrying",Ya,Math.floor(ca.a.Pe()-mb)),Fa.avc(ma,xa,Pa,ib,pb,xb,Ya)):db.ErrorCode===
a.Q9e&&!Pa&&(x.ULS.sendTraceTag(561517645,3E3,50,"TryGetToken attempt {0} failed with ITP error.  3P Cookies are [{1}]. Retry: [{2]}]",Ya,a.s2c),a.j8g&&Fa.ON.Itc()&&Fa.ON.cvc(ma,ta,xa,Pa,ib,pb).then(function(Na){return Promise.resolve(Fa.efc(Na,ma,xa,ta,mb))}).catch(function(){var Na,kb=(Na=new z,Na.IsSuccess=!1,Na.Token=null,Na.ErrorCode="authTokenStrategy_failure",Na.ErrorMessage="LoginPopup failed, GetToken could not be called",Na);return Promise.resolve(Fa.efc(kb,ma,xa,ta,mb))}),a.s2c)?Fa.avc(ma,
xa,!0,ib,pb,xb,Ya):Promise.resolve(Fa.efc(db,ma,xa,ta,mb))}).catch(function(){var db,Na=(db=new z,db.IsSuccess=!1,db.Token=null,db.ErrorCode="authTokenStrategy_failure",db.ErrorMessage="Auth Strategy failed with an unknown error",db);return Promise.resolve(eb.efc(Na,ma,xa,ta,mb))})};a.prototype.yZh=function(ma,xa,Pa,ib,pb,xb,Ya,ab){var ea=this;return 1===ab||2===ab?this.wnd(Object.assign(new z,{IsSuccess:!1,Token:null,ErrorCode:"InitFailed",ErrorMessage:"Auth Strategy Failed to Init or Load"}),ma):
this.ON.aR(ma,xa,Pa,ib,pb,xb,Ya).then(function(ta){return Promise.resolve(ea.Ohf(ta,!0,ma))}).catch(function(ta){return Promise.resolve(ea.Ohf(ta,!1,ma))})};a.prototype.efc=function(ma,xa,Pa,ib,pb){var xb={};pb=ca.a.Pe()-pb;xb.IsSuccess=ma.IsSuccess;xb.ErrorCode=ma.IsSuccess?"Success":ma.ErrorCode||"";xb.ErrorMessage=ma.IsSuccess?"Success":this.zOa(xa,ma.ErrorMessage||"");xb.Target=this.zOa(xa,Pa||"");xb.TimeInMS=Math.floor(pb);xb.AuthLibrary=this.OD();xb.AppName=xa;xb.AuthorityType=Object(y.a)(E,
A.a.G6b());xb.UserType=this.LKh(A.a.getAuthContext());xb.IsAuthSupportedInSession=J.a[this.mR];xb.RequestCount=++this.uig;xb.AppId=ib;x.ULS.sendTraceTag(593863640,3E3,50,JSON.stringify(xb));ma.IsSuccess||(Pa=this.fs(),void 0!==Pa&&null!==Pa&&(Pa.set("AppName",xa),Pa.set("AuthLibrary",this.OD()),Pa.set("ErrorCode",ma.ErrorCode),Pa.set("ErrorMessage",this.zOa(xa,ma.ErrorMessage)),xa=Object.assign(new La.a,{durationMs:pb,extendedProperties:Pa}),Z.Health.instance.recordKpiFailure(a.kpiName,"TryGetTokenFailure",
!1,!0,xa)));return ma};a.prototype.wnd=function(ma,xa){x.ULS.sendTraceTag(578435090,3E3,15,"OAuthManager failed without invoking GetToken. AppName: '{0}', Reason: '{1}'",xa,this.zOa(xa,ma.ErrorMessage));var Pa=this.fs();void 0!==Pa&&null!==Pa&&(Pa.set("AppName",xa),Pa.set("AuthLibrary",this.OD()),Pa.set("ErrorCode",ma.ErrorCode),Pa.set("ErrorMessage",this.zOa(xa,ma.ErrorMessage)),xa=Object.assign(new La.a,{extendedProperties:Pa}),Z.Health.instance.recordKpiFailure(a.kpiName,"FailureBeforeGetToken",
!1,!0,xa));return Promise.resolve(ma)};a.prototype.f5e=function(ma){return ma===na.a.suc};a.prototype.zOa=function(ma,xa){return this.f5e(ma)&&xa?"REDACTED":xa};a.prototype.LKh=function(ma){return H.AFrameworkApplication.ha.sa("IsAnonymousUser")?"anonymous":!ma.loginHint||1>ma.loginHint.length?"empty":-1<ma.loginHint.indexOf("guest#")?"guest":-1<ma.loginHint.indexOf("ext#")?"external":0>ma.upn.indexOf("@")?"no-at":"supported"};a.prototype.NJa=function(){return 1===this.mR};a.prototype.Ohf=function(ma,
xa,Pa){var ib=null,pb=null,xb=null,Ya=null;ma?ma.ErrorCode||ma.ErrorMessage?(pb=ma.ErrorCode?ma.ErrorCode:a.AIe,xb=ma.ErrorMessage?ma.ErrorMessage:"No message"):ma.Token?xa?ib=ma.Token:(pb=a.BRi,xb="A rejected promise returned a token."):(pb=a.AIe,xb=JSON.stringify(ma)):(pb=a.bli,xb="No result came from Auth Token Strategy");ma&&ma.Telemetry&&!this.f5e(Pa)&&(Ya=ma.Telemetry,x.ULS.sendTraceTag(579166408,3E3,50,JSON.stringify(Ya)));if(pb===a.Uii||pb===a.Sqj)pb=a.cZf,xb="Auth Library Timed Out";pb===
a.bAg&&-1<xb.indexOf(a.vmg)&&(pb=a.Q9e);if(pb||xb)ib=null;return Object.assign(new z,{IsSuccess:!!ib,Token:ib,ErrorCode:pb,ErrorMessage:xb,Telemetry:Ya})};a.prototype.fs=function(){try{return new Map}catch(ma){return null}};a.b4h=function(){var ma=S.a.k3g;return ma&&(Q.a.$z&&Array.contains(ma,"Electron")||Q.a.adc&&Array.contains(ma,"Safari")&&!a.s2c)?!1:!0};Ll.Object.defineProperties(a,{s2c:{configurable:!0,enumerable:!0,get:function(){return H.AFrameworkApplication.ha.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthInteractiveFallbackEnabled",
!1)}},j8g:{configurable:!0,enumerable:!0,get:function(){return H.AFrameworkApplication.ha.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthLoginFlowEnabled",!1)}}});a.Sqj="token_renewal_error";a.AIe="Exception";a.bli="NoResult";a.BRi="RejectToken";a.Uii="monitor_window_timeout";a.cZf="Timeout";a.vmj="authTokenStrategy_timeout";a.bAg="login_required";a.vmg="AADSTS50058";a.Q9e="Cookies Disabled";a.kpiName="OAuthManager";a.chi=2;Object(C.a)(a,"OAuthManager",null,[219])}}]);

//# sourceMappingURL=EwaDS.oauth.js.map